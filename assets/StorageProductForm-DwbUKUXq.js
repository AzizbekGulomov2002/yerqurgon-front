import{r as $,u as ve,M as Ne,as as he,a2 as Re,au as ie,j as e,B as T,av as De,O as f,C as R,o as z,aw as Be,X as x,ax as Ue,ay as v,az as Ve,aA as pe,aB as w,aC as D,aD as me,aE as Ke,aF as Xe}from"./index-TTKrRBsV.js";import{u as He,a as Le,C as Qe,b as We}from"./CreateProductModal-C8QmnMdM.js";import{C as qe}from"./CustomDatePicker-dCRvPDUL.js";import{C as q}from"./CustomInputNumber-BoiyYvjJ.js";import{C as Ye}from"./CustomSwitch-ir5s6zur.js";import{C as ze}from"./CustomTextarea-DTb8tAvY.js";import{C as K}from"./CardTitle-WCnvc5ze.js";import{T as X}from"./TitleAndIconText-Dlp7yQ8-.js";import{u as Ge}from"./useProducts-TVEJRWTV.js";import{f as Ze}from"./storages.requests-Clr69Zlx.js";import{u as Je}from"./useQuery-DXHJDm7O.js";import{u as er}from"./useSuppliers-Bt7n3lGa.js";import{a as rr}from"./storage-products-DKKZrFLu.js";import{c as H,a as p,o as be,u as Se,F as n,C as d,d as xe,e as te,f as je,g as ge}from"./index.esm-Dv3jW_V-.js";import{C as fe}from"./CustomInput-CfXd1HaZ.js";import{u as sr}from"./useSupplierTypes-D9hZVEYZ.js";import{p as tr}from"./suppliers-B1x7mLyS.js";import{h as ir}from"./suppliers.requests-CZGt-cgQ.js";import{M as ar,R as ye}from"./DeleteFilled-Lrowix85.js";import{D as L}from"./index-CwYkfvr8.js";import{R as F,C as o}from"./row-Bxwr5CQq.js";import{C as N}from"./index-Chkbatr3.js";import{R as or}from"./PlusOutlined-Ba-GwlE8.js";const nr=j=>{const{data:M=[],refetch:S,...E}=Je({queryKey:["all-storages"],queryFn:Ze,select:g=>g.data});$.useEffect(()=>{S()},[j,S]);const s=$.useMemo(()=>M.map(g=>({text:`${g.name}`,label:`${g.name}`,value:g.id})),[M]);return{storagesData:M,storagesLoading:E.isLoading,storagesError:E.isError,storagesOptions:s,...E}},cr=()=>{const{t:j}=ve(),[M,S]=$.useState(!1),E=()=>{S(!0)},s=()=>{S(!1)},{isLoading:g,isPending:ae,mutateAsync:Q}=Ne({mutationFn:ir,onSuccess:()=>{he(),Re(j("Muvaffaqiyatli bajarildi !"))},onError:i=>{he(),console.log(i)}}),W=H().shape({supplier_type:p().required(j("Maydonni kiritishingiz shart !")),name:p().required(j("Maydonni kiritishingiz shart !")),added:p().required(j("Maydonni kiritishingiz shart !"))}),B=be(W),A=sr(),{control:k,formState:{errors:_},reset:O,watch:oe,...c}=Se({defaultValues:{added:ie()},resolver:B}),u=()=>O({}),Y=c.handleSubmit(async i=>{try{const y=await Q(tr(i));(y==null?void 0:y.status)===201&&(u(),s(),window.location.reload())}catch(y){console.error("Error during form submission:",y)}});return e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>E(),icon:e.jsx(De,{size:16})}),e.jsx(ar,{title:j("Ta'minotchi qo'shish"),open:M,onCancel:s,footer:null,children:e.jsxs(n,{layout:"vertical",className:"create-form",name:"create-form",size:"large",onFinish:Y,children:[e.jsx(L,{}),e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:12,children:e.jsx(n.Item,{label:j("Ta'minotchi nomi"),...f(_,"name"),required:!0,children:e.jsx(d,{name:"name",control:k,render:({field:i})=>e.jsx(fe,{...i})})})}),e.jsx(o,{xs:24,md:12,children:e.jsx(n.Item,{label:j("Telefon raqami"),...f(_,"phone"),required:!1,children:e.jsx(d,{name:"phone",control:k,render:({field:i})=>e.jsx(fe,{...i})})})}),e.jsx(o,{xs:24,md:12,children:e.jsx(n.Item,{label:j("Ta'minotchi turi"),...f(_,"supplier_type"),required:!0,children:e.jsx(d,{name:"supplier_type",control:k,render:({field:i})=>e.jsx(R,{showSearch:!1,options:A,...i})})})}),e.jsx(o,{xs:24,md:12,children:e.jsx(n.Item,{label:j("Qo'shilgan vaqti"),...f(_,"added"),required:!0,children:e.jsx(d,{name:"added",control:k,render:({field:i})=>e.jsx(qe,{...i})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:j("Izoh"),...f(_,"desc"),children:e.jsx(d,{name:"desc",control:k,render:({field:i})=>e.jsx(ze,{...i})})})})]}),e.jsx(L,{}),e.jsx(n.Item,{children:e.jsxs(z,{align:"center",justify:"end",gap:"middle",children:[e.jsx(T,{htmlType:"button",onClick:s,children:j("Bekor qilish")}),e.jsx(T,{type:"primary",htmlType:"submit",loading:g,disabled:g,children:j("Yuborish")})]})})]})})]})},wr=({defaultValues:j,handleSubmit:M,actionLoading:S=!1,readOnly:E=!1})=>{const{t:s}=ve(),{company:{currency_type:g}}=Be(),ae=H().shape({supplier:p().required(s("Maydonni kiritishingiz shart !")),cash:p().nullable(),card:p().nullable(),other:p().nullable(),date:p().required(s("Maydonni kiritishingiz shart !")),products:xe().of(H().shape({product:p().required(s("Maydonni kiritishingiz shart !")),storage:p().when("product",{is:t=>{const r=O.find(a=>a.id==t);return(r==null?void 0:r.product_type)==="Sanaladigan"},then:()=>p().required(s("Maydonni kiritishingiz shart !"))}),price:p().required(s("Maydonni kiritishingiz shart !")),size_type:p().required(s("Maydonni kiritishingiz shart !")),count:te().min(0,s("Miqdor noldan katta yoki teng bo'lishi kerak !")).required(s("Maydonni kiritishingiz shart !")),part_size:p().when("size_type",{is:"O'lchovli",then:()=>p().required(s("Maydonni kiritishingiz shart !"))}),height:p().when("size_type",{is:"Formatli",then:()=>p().required(s("Maydonni kiritishingiz shart !"))}),width:p().when("size_type",{is:"Formatli",then:()=>p().required(s("Maydonni kiritishingiz shart !"))})})),services:xe().of(H().shape({service:p().required(s("Maydonni kiritishingiz shart !")),count:te().min(0,s("Miqdor noldan katta yoki teng bo'lishi kerak !")).required(s("Maydonni kiritishingiz shart !")),price:te().min(0,s("Narx noldan katta yoki teng bo'lishi kerak !")).required(s("Maydonni kiritishingiz shart !"))}))}).test("one-of-three-required",s("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!"),function(t){const{path:r,createError:a}=this,h=parseFloat(t.cash)||0,m=parseFloat(t.card)||0,I=parseFloat(t.other)||0;return h>=0||m>=0||I>=0?!0:a({path:`${r}.cash`,message:s("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!")})}).test("total-less-than-summa",s("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!"),function(t){const{path:r,createError:a}=this,h=parseFloat(t.cash)||0,m=parseFloat(t.card)||0,I=parseFloat(t.other)||0;return h+m+I<=C?!0:a({path:`${r}.total_summa`,message:s("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!")})}),Q=be(ae),{storagesOptions:W}=nr(),{servicesOptions:B}=He(),{suppliersOptions:A,suppliersData:k}=er(),{productsOptions:_,productsData:O}=Ge({product_type:"Sanaladigan"}),oe=Le(),{control:c,formState:{errors:u},reset:Y,watch:i,setValue:y,getValues:b,...ke}=Se({defaultValues:{date:ie(),supplier:"",products:[{size_type:"O'lchovsiz"}],services:[],pay_type:!0,...j},resolver:Q}),{fields:ne,append:Ce,remove:Fe}=je({control:c,name:"products"}),{fields:ce,append:Te,remove:G}=je({control:c,name:"services"});$.useEffect(()=>{if(A&&A.length>0){const t=k.find(r=>x.get(r,"supplier_type")==="Tezkor");t&&y("supplier",x.get(t,"id",""))}},[A,y]);const Z=()=>{const t=k.find(r=>x.get(r,"supplier_type")==="Tezkor");Y({date:ie(),supplier:x.get(t,"id",""),products:[{size_type:"O'lchovsiz"}],services:[],pay_type:!0})},Me=ke.handleSubmit(t=>{Z(),M(rr(t),Z)}),_e=t=>{const r=i("services")||[];if(t.length===0){r.slice().reverse().forEach((h,m)=>G(r.length-1-m));return}const a=t.map(h=>h[0]);t.forEach(h=>{r.some(m=>m.service===h[0])||Te({service:h[0],count:1})}),r.forEach((h,m)=>{a.includes(h.service)||G(m)})},Ie=t=>{var h;const a=(i("services")||[])[t].service;G(t),y("service_types",(h=i("service_types"))==null?void 0:h.filter(m=>m[0]!==a))},J=ge({control:c,name:"services"}),ee=ge({control:c,name:"products"}),U=J==null?void 0:J.reduce((t,r)=>{const a=parseFloat(x.get(r,"price",0)),h=parseFloat(x.get(r,"count",0)),m=a*h;return t+parseFloat(m.toFixed(2))},0),V=ee==null?void 0:ee.reduce((t,r)=>{const a=parseFloat(x.get(r,"price",0)),h=parseFloat(x.get(r,"count",0)),m=parseFloat(x.get(r,"part_size",1)),I=parseFloat(x.get(r,"width",1)),re=parseFloat(x.get(r,"height",1)),se=a*h*m*I*re;return t+parseFloat(se.toFixed(2))},0),C=(U||0)+(V||0),P=i("pay_type");$.useEffect(()=>{if(P){const t=b("card")||0,r=b("other")||0,a=C-t-r;a!==b("cash")&&y("cash",a>=0?a:0)}},[C,i("card"),i("other"),P]),$.useEffect(()=>{if(P){const t=b("cash")||0,r=b("other")||0,a=C-t-r;a!==b("card")&&y("card",a>=0?a:0)}},[C,i("cash"),i("other"),P]),$.useEffect(()=>{if(P){const t=b("cash")||0,r=b("card")||0,a=C-t-r;a!==b("other")&&y("other",a>=0?a:0)}},[C,i("cash"),i("card"),P]);const we=i(["cash","card","other"]).reduce((t,r)=>t+(r||0),0);return e.jsxs(n,{layout:"vertical",className:"create-form",name:"create-form",size:"large",onFinish:Me,children:[e.jsx(L,{}),e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:18,children:e.jsxs(z,{gap:"large",vertical:!0,children:[e.jsx(N,{title:e.jsx(K,{title:s("Ta'minotchi va xizmatlar")}),children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Ta'minotchi"),...f(u,"supplier"),required:!0,children:e.jsx(d,{name:"supplier",control:c,render:({field:t})=>e.jsxs(Ue.Compact,{style:{width:"100%"},children:[e.jsx(R,{options:A,addonAfter:"AAA",...t,style:{width:"100%"}}),e.jsx(cr,{})]})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Xizmatlar"),...f(u,"service_types"),required:!1,children:e.jsx(d,{name:"service_types",control:c,render:({field:t})=>e.jsx(Qe,{...t,options:B,onChange:r=>{t.onChange(r),_e(r)},multiple:!0})})})})]})}),!x.isEmpty(ce)&&e.jsx(N,{title:e.jsx(K,{title:s("Qo'shimcha xizmatlar")}),children:e.jsxs(z,{gap:"large",vertical:!0,children:[ce.map((t,r)=>e.jsx(e.Fragment,{children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:22,children:e.jsx(N,{hoverable:!0,children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Xizmat"),...v(u,"services",r,"service"),required:!0,children:e.jsx(d,{name:`services.${r}.service`,control:c,render:({field:a})=>e.jsx(R,{...a,disabled:!0,options:B})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Miqdori"),...v(u,"services",r,"count"),required:!0,children:e.jsx(d,{name:`services.${r}.count`,control:c,render:({field:a})=>e.jsx(q,{...a})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Narxi"),...v(u,"services",r,"price"),required:!0,children:e.jsx(d,{name:`services.${r}.price`,control:c,render:({field:a})=>e.jsx(q,{addonAfter:g,...a})})})})]},t.id)})}),e.jsx(o,{xs:24,md:2,children:e.jsx(T,{icon:e.jsx(ye,{}),danger:!0,size:"small",onClick:()=>Ie(r)})})]})})),e.jsxs(z,{gap:"small",align:"center",children:[e.jsx(Ve,{size:20}),e.jsxs(pe.Text,{type:"warning",strong:!0,children:[s("SUMMA"),": ",w(U)]})]})]})}),e.jsx(N,{title:e.jsxs(z,{horizontal:!0,align:"center",justify:"space-between",children:[e.jsx(K,{title:s("Mahsulotlar")}),e.jsxs(z,{align:"center",justify:"space-between",gap:"20px",children:[e.jsx(We,{}),e.jsx(T,{icon:e.jsx(or,{}),type:"primary",size:"small",onClick:()=>Ce({size_type:"O'lchovsiz"}),children:s("MAHSULOT")})]})]}),children:e.jsxs(z,{gap:"large",vertical:!0,children:[ne.map((t,r)=>{var le;const a=(le=O.find(l=>l.id===i(`products.${r}.product`)))==null?void 0:le.product_type,h=i("products").map(l=>l.product),m=i(`products.${r}.product`),I=_.filter(l=>!h.includes(l.value)||l.value===m),re=O.find(l=>l.id===m),se=parseFloat(x.get(i(`products.${r}`),"count",0)),$e=parseFloat(x.get(i(`products.${r}`),"part_size",1)),Ee=parseFloat(x.get(i(`products.${r}`),"width",1)),Ae=parseFloat(x.get(i(`products.${r}`),"height",1)),Oe=se*$e*Ee*Ae;return e.jsx(e.Fragment,{children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:22,children:e.jsx(N,{hoverable:!0,children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Mahsulot"),...v(u,"products",r,"product"),required:!0,children:e.jsx(d,{name:`products.${r}.product`,control:c,render:({field:l})=>e.jsx(R,{...l,options:I,onChange:de=>{l.onChange(de);const ue=O.find(Pe=>Pe.id===de);ue&&y(`products.${r}.price`,ue.price)}})})})}),a==="Sanaladigan"&&e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Ombor"),...v(u,"products",r,"storage"),required:!0,children:e.jsx(d,{name:`products.${r}.storage`,control:c,render:({field:l})=>e.jsx(R,{...l,options:W})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Narxi"),...v(u,"products",r,"price"),required:!0,children:e.jsx(d,{name:`products.${r}.price`,control:c,render:({field:l})=>e.jsx(q,{addonAfter:g,...l})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("O'lcham turi"),...v(u,"products",r,"size_type"),required:!0,children:e.jsx(d,{name:`products.${r}.size_type`,control:c,render:({field:l})=>e.jsx(R,{options:oe,showSearch:!1,...l})})})}),i(`products.${r}.size_type`)==="O'lchovli"&&e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("O'lchami"),...v(u,"products",r,"part_size"),required:!0,children:e.jsx(d,{name:`products.${r}.part_size`,control:c,render:({field:l})=>e.jsx(q,{min:0,...l})})})}),i(`products.${r}.size_type`)==="Formatli"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Bo'yi"),...v(u,"products",r,"height"),required:!0,children:e.jsx(d,{name:`products.${r}.height`,control:c,render:({field:l})=>e.jsx(q,{min:0,...l})})})}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Eni"),...v(u,"products",r,"width"),required:!0,children:e.jsx(d,{name:`products.${r}.width`,control:c,render:({field:l})=>e.jsx(q,{min:0,...l})})})})]}),e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Miqdori"),...v(u,"products",r,"count"),required:!0,children:e.jsx(d,{name:`products.${r}.count`,control:c,render:({field:l})=>e.jsx(q,{min:0,...l})})})}),m&&e.jsx(o,{xs:24,md:6,children:e.jsx(n.Item,{label:s("Umumiy miqdor"),...v(u,"products",r,"total_count"),children:w(Oe,x.get(re,"format.name",""))})})]},t.id)})}),e.jsx(o,{xs:24,md:2,children:ne.length>1&&e.jsx(T,{icon:e.jsx(ye,{}),danger:!0,size:"small",onClick:()=>Fe(r)})})]})})}),e.jsxs(z,{gap:"small",align:"center",children:[e.jsx(D,{size:20}),e.jsxs(pe.Text,{type:"default",strong:!0,children:[s("SUMMA"),": ",w(V)]})]})]})})]})}),e.jsx(o,{xs:24,md:6,children:e.jsx(N,{title:e.jsx(K,{title:s("To'lov")}),children:e.jsxs(F,{gutter:[20,20],children:[e.jsx(o,{xs:24,md:24,children:e.jsxs(z,{vertical:!0,gap:"middle",children:[e.jsx(X,{title:s("Mahsulotlar").toUpperCase(),value:w(V),icon:e.jsx(D,{})}),e.jsx(X,{type:"warning",title:s("Xizmatlar").toUpperCase(),value:w(U),icon:e.jsx(D,{})}),e.jsx(X,{type:"success",title:s("Umumiy summa").toUpperCase(),value:w(C),icon:e.jsx(D,{})})]})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Barchasini to'lash"),...f(u,"pay_type"),required:!0,children:e.jsx(d,{name:"pay_type",control:c,render:({field:t})=>e.jsx(Ye,{prefix:e.jsx(me,{}),...t})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Naqt"),...f(u,"cash"),required:!0,children:e.jsx(d,{name:"cash",control:c,render:({field:t})=>e.jsx(q,{addonAfter:g,prefix:e.jsx(me,{}),...t})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Karta orqali"),...f(u,"card"),required:!0,children:e.jsx(d,{name:"card",control:c,render:({field:t})=>e.jsx(q,{addonAfter:g,prefix:e.jsx(Ke,{}),...t})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Boshqa"),...f(u,"other"),required:!0,children:e.jsx(d,{name:"other",control:c,render:({field:t})=>e.jsx(q,{addonAfter:g,prefix:e.jsx(Xe,{}),...t})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{...f(u,"total_summa"),children:e.jsx(X,{type:"success",title:s("Summa").toUpperCase(),value:w(we),icon:e.jsx(D,{})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Sana"),...f(u,"date"),required:!0,children:e.jsx(d,{name:"date",control:c,render:({field:t})=>e.jsx(qe,{...t})})})}),e.jsx(o,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Izoh"),...f(u,"desc"),children:e.jsx(d,{name:"desc",control:c,render:({field:t})=>e.jsx(ze,{...t})})})})]})})})]}),e.jsx(L,{}),e.jsx(n.Item,{children:e.jsxs(z,{align:"center",justify:"end",gap:"middle",children:[e.jsx(T,{htmlType:"button",onClick:Z,children:s("Tozalash")}),e.jsx(T,{type:"primary",htmlType:"submit",loading:S,disabled:S,children:s("Yuborish")})]})})]})};export{wr as S};
