import{l as N,u as z,r as u,M as D,a3 as Y,a2 as R,j as e,o,N as $,Z as _,O as x,a0 as Q,B as L,V as K,X as g,S as C,U as X,a4 as Z}from"./index-TTKrRBsV.js";import{C as G,a as F}from"./CustomPhoneInput-Dyz5Xq3R.js";import{c as U,a as h,u as A,o as M,F as n,C as j,b as H}from"./index.esm-Dv3jW_V-.js";import{S as J}from"./SignUpPage.styles-Z45kjIAM.js";import{C as ee}from"./index.es-D5aqwRbg.js";import{C as O}from"./index-Chkbatr3.js";import{R as p,C as t}from"./row-Bxwr5CQq.js";import{I as se}from"./index-CRizbU4B.js";import"./index-DNWE43hh.js";import"./Skeleton-Bgqqq5sk.js";import"./index-CB8Qoy1w.js";import"./PlusOutlined-Ba-GwlE8.js";const{Title:E,Text:re}=K,te=({forgotPasswordData:f,user_email:s,setStep:y})=>{const l=N(),{t:d}=z(),[w,I]=u.useState(Date.now()+18e4),k=U().shape({verification_code:h().required(d("Kod kiritilishi kerak !"))}),a=D({mutationKey:["reset-password"],mutationFn:Y,onSuccess:i=>{R(d("Parol muvaffaqiyatli o'zgartirildi !")),l("/auth/sign-in")},onError:i=>{console.log(i)}}),{handleSubmit:v,control:S,getValues:b,formState:{errors:P}}=A({defaultValues:{},resolver:M(k)}),c=i=>{const m={username:g.get(f,"username",""),verification_code:Number(g.get(i,"verification_code",""))};a.mutateAsync(m)},q=({hours:i,minutes:m,seconds:r,completed:T})=>{if(T)return y("forgot"),null;const B=String(m).padStart(2,"0"),W=String(r).padStart(2,"0");return e.jsxs("span",{children:[B,":",W]})};return e.jsx(e.Fragment,{children:e.jsx(O,{style:{maxWidth:"300px"},children:e.jsxs(p,{gutter:[0,24],children:[e.jsx(t,{span:24,children:e.jsx(o,{align:"center",justify:"center",children:e.jsx("img",{onClick:()=>l("/"),src:$,style:{width:"100px",cursor:"pointer"},alt:""})})}),e.jsx(t,{span:24,children:e.jsxs(o,{align:"center",justify:"center",vertical:!0,children:[e.jsx(E,{level:2,children:d("Tasdiqlash")}),e.jsx(re,{level:5,align:"center",children:_.language==="uz"?e.jsxs(e.Fragment,{children:["Tasdiqlash kodi ",e.jsx("b",{children:s})," ga yuborildi. ",e.jsx("br",{}),"Iltimos tasdiqlash kodini kiriting !"]}):_.language=="en"?e.jsxs(e.Fragment,{children:["Verification code sent to ",e.jsx("b",{children:s}),". ",e.jsx("br",{}),"Please enter the verification code!"]}):e.jsxs(e.Fragment,{children:["Код подтверждения отправлен на адрес ",e.jsx("b",{children:s}),"."," ",e.jsx("br",{}),"Пожалуйста, введите проверочный код!"]})})]})}),e.jsx(t,{span:24,children:e.jsx(n,{layout:"vertical",className:"login-form",name:"login-form",size:"large",onFinish:v(c),children:e.jsxs(p,{gutter:[15,15],children:[e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{style:{display:"flex",alignItems:"center",justifyContent:"center"},...x(P,"verification_code"),required:!0,children:e.jsx(j,{name:"verification_code",control:S,render:({field:i})=>e.jsx(se.OTP,{...i,length:4,prefix:e.jsx(Q,{})})})})}),e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{style:{marginTop:"20px"},children:e.jsx(L,{style:{width:"100%"},type:"primary",htmlType:"submit",loading:a.isLoading||a.isPending,disabled:a.isLoading||a.isPending,children:d("Tasdiqlash")})})})]})})}),e.jsx(t,{span:24,children:e.jsx(o,{align:"center",justify:"center",children:e.jsx(E,{level:5,children:e.jsx(ee,{date:w,renderer:q})})})})]})})})},{Title:ie,Text:V}=K,pe=()=>{const f=N(),{t:s}=z(),[y,l]=u.useState("register"),[d,w]=u.useState(null),[I,k]=u.useState(null),a=U().shape({username:h().required(s("Telefon raqami kiritilishi kerak !")),new_password:h().required(s("Parol kiritilishi kerak !")),new_password2:h().oneOf([H("new_password"),null],s("Parollar mos kelishi kerak !")).required(s("Parolni qayta kiriting !"))}),v=D({mutationKey:["forgot-password"],mutationFn:Z,onSuccess:r=>{R(s("Emailga tasdiqlash kodi yuborildi !")),l("verify"),w(r.data.user_id),k(r.data.user_email)},onError:r=>{console.log(r)}}),{mutateAsync:S,isPending:b}=v,{handleSubmit:P,control:c,getValues:q,formState:{errors:i}}=A({defaultValues:{phone:"",password:""},resolver:M(a)}),m=r=>{const T={username:g.get(r,"username",""),new_password:g.get(r,"new_password","")};S(T)};return e.jsx(J,{children:y==="verify"?e.jsx(te,{forgotPasswordData:q(),setStep:l,user_email:I}):e.jsx(O,{style:{maxWidth:"350px"},children:e.jsxs(p,{gutter:[0,24],children:[e.jsx(t,{span:24,children:e.jsx(o,{align:"center",justify:"center",children:e.jsx("img",{onClick:()=>f("/"),src:$,style:{width:"100px",cursor:"pointer"},alt:""})})}),e.jsx(t,{span:24,children:e.jsxs(o,{align:"center",justify:"center",vertical:!0,children:[e.jsx(ie,{level:2,children:s("Parolni tiklash")}),e.jsx(V,{children:s("Iltimos, email va yangi parolingizni kiriting.")})]})}),e.jsx(t,{span:24,children:e.jsx(n,{layout:"vertical",className:"login-form",name:"login-form",size:"large",onFinish:P(m),children:e.jsxs(p,{gutter:[15,15],children:[e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Telefon raqam"),...x(i,"username"),required:!0,children:e.jsx(j,{name:"username",control:c,render:({field:r})=>e.jsx(G,{...r})})})}),e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Yangi parol"),...x(i,"new_password"),required:!0,children:e.jsx(j,{name:"new_password",control:c,render:({field:r})=>e.jsx(F,{...r,placeholder:s("Parolni kiriting"),prefix:e.jsx(C,{})})})})}),e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{label:s("Parolni tasdiqlang"),...x(i,"new_password2"),required:!0,children:e.jsx(j,{name:"new_password2",control:c,render:({field:r})=>e.jsx(F,{...r,placeholder:s("Parolni qayta kiriting"),prefix:e.jsx(C,{})})})})}),e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{children:e.jsx(L,{style:{width:"100%",marginTop:"10px"},type:"primary",htmlType:"submit",loading:b,disabled:b,children:s("Yuborish")})})}),e.jsx(t,{xs:24,md:24,children:e.jsx(n.Item,{children:e.jsx(o,{align:"center",justify:"center",children:e.jsxs(V,{children:[e.jsxs("span",{style:{marginRight:"5px"},children:[s("Akkauntingiz bo'lsa"),":"]}),e.jsx(X,{to:"/auth/sign-in",children:s("Kirish")})]})})})})]})})})]})})})};export{pe as default};
