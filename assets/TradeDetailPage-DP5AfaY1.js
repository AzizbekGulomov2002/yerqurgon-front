import{r as I,aw as de,u as q,au as me,M as ae,a2 as re,j as e,B as P,o as C,aB as i,aG as xe,O as F,aD as z,aE as H,aF as O,aC as se,X as r,at as ie,Q as ue,U as he,ar as je,aH as pe,aI as ne,z as ge,aJ as ye,aK as fe,aL as A,aM as be,aN as ve,y as Z,aO as W,aP as Y,aQ as Ce}from"./index-TTKrRBsV.js";import{B as ke}from"./BackButton-BLVW6gZr.js";import{C as Fe}from"./CustomTabs-DeR7qKEd.js";import{C as ee}from"./CardTitle-WCnvc5ze.js";import{C as V}from"./CustomDataTable-D2IlOEuA.js";import{C as Te}from"./CustomModalConfirm-DuPb8srr.js";import{P as qe,E as Ue}from"./PageLoader-DmyE2ANN.js";import{P as Ie,B as _e}from"./PageTitle-OKMYAOp7.js";import{T as n}from"./TitleAndIconText-Dlp7yQ8-.js";import{d as Ne,e as Pe,c as Se}from"./trade.requests-D_bujT-q.js";import{u as ze}from"./useQuery-DXHJDm7O.js";import{C as Be}from"./CustomDatePicker-dCRvPDUL.js";import{C as R}from"./CustomInputNumber-BoiyYvjJ.js";import{C as Me}from"./CustomSwitch-ir5s6zur.js";import{b as Ee}from"./trade-CwsITbu-.js";import{c as De,a as w,u as Qe,F as v,C as U,o as Ae}from"./index.esm-Dv3jW_V-.js";import{M as Re,R as we}from"./DeleteFilled-Lrowix85.js";import{R as S,C as x}from"./row-Bxwr5CQq.js";import{T as _}from"./index-CB8Qoy1w.js";import{C as K}from"./index-Chkbatr3.js";import{D as T}from"./index-CwYkfvr8.js";import{T as N}from"./index-Ce0i5KU3.js";import"./LeftOutlined-30Vtg-fw.js";import"./Table-DaguqWZh.js";import"./index-CRizbU4B.js";import"./index-DVNdkQR1.js";import"./useClosable-CgTQR01w.js";import"./Skeleton-Bgqqq5sk.js";import"./fade-m1HoRkfl.js";import"./PlusOutlined-Ba-GwlE8.js";const te=({summa:o,refetch:a,item:t})=>{var G;const[l,p]=I.useState(!1),{company:{currency_type:u}}=de(),d=()=>{p(!0)},h=()=>{p(!1)},{t:c}=q(),L=De().shape({cash:w().nullable(),card:w().nullable(),other:w().nullable()}).test("one-of-three-required",c("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!"),function(s){const{path:j,createError:m}=this,E=parseFloat(s.cash)||0,D=parseFloat(s.card)||0,Q=parseFloat(s.other)||0;return E>0||D>0||Q>0?!0:m({path:`${j}.cash`,message:c("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!")})}).test("total-less-than-summa",c("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!"),function(s){const{path:j,createError:m}=this,E=parseFloat(s.cash)||0,D=parseFloat(s.card)||0,Q=parseFloat(s.other)||0;return E+D+Q<=o?!0:m({path:`${j}.total_summa`,message:c("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!")})}),B=Ae(L),{control:b,formState:{errors:y},handleSubmit:$,setValue:M,getValues:g,watch:f,reset:oe}=Qe({resolver:B,defaultValues:{date:me(),pay_type:!0}}),{isLoading:J,mutateAsync:le}=ae({mutationFn:Ne,onSuccess:()=>{re(c("Muvaffaqiyatli bajarildi !")),h(),oe(),a()},onError:s=>{console.log(s)}}),X=s=>{le(Ee({...s,trade:r.get(t,"id","")}))},k=f("pay_type");I.useEffect(()=>{if(k){const s=g("card")||0,j=g("other")||0,m=o-s-j;m!==g("cash")&&M("cash",m>=0?m:0)}},[o,f("card"),f("other"),k]),I.useEffect(()=>{if(k){const s=g("cash")||0,j=g("other")||0,m=o-s-j;m!==g("card")&&M("card",m>=0?m:0)}},[o,f("cash"),f("other"),k]),I.useEffect(()=>{if(k){const s=g("cash")||0,j=g("card")||0,m=o-s-j;m!==g("other")&&M("other",m>=0?m:0)}},[o,f("cash"),f("card"),k]);const ce=f(["cash","card","other"]).reduce((s,j)=>s+(parseFloat(j)||0),0);return e.jsxs(e.Fragment,{children:[e.jsx(P,{onClick:d,type:"primary",children:c("To'lov qilish")}),e.jsx(Re,{width:400,centered:!0,title:c("To'lov qilish"),open:l,onCancel:h,footer:[e.jsxs(C,{align:"center",gap:"middle",justify:"end",children:[e.jsx(P,{onClick:h,children:c("Bekor qilish")},"cancel"),e.jsx(P,{type:"primary",disabled:J,loading:J,onClick:$(X),children:c("To'lash")},"submit")]})],children:e.jsx(v,{layout:"vertical",onFinish:$(X),style:{margin:"30px 0px"},children:e.jsxs(S,{gutter:[20,15],children:[e.jsx(x,{xs:24,md:24,children:e.jsx(n,{type:"danger",title:c("Qarzdorlik").toUpperCase(),value:i(o),icon:e.jsx(xe,{})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{label:c("Barcha qarzdorlikni to'lash"),...F(y,"pay_type"),required:!0,children:e.jsx(U,{name:"pay_type",control:b,render:({field:s})=>e.jsx(Me,{prefix:e.jsx(z,{}),...s})})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{label:c("Naqt"),...F(y,"cash"),required:!0,help:(G=y.cash)==null?void 0:G.message,validateStatus:y.cash?"error":"",children:e.jsx(U,{name:"cash",control:b,render:({field:s})=>e.jsx(R,{addonAfter:u,prefix:e.jsx(z,{}),...s})})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{label:c("Karta orqali"),...F(y,"card"),required:!0,children:e.jsx(U,{name:"card",control:b,render:({field:s})=>e.jsx(R,{addonAfter:u,prefix:e.jsx(H,{}),...s})})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{label:c("Boshqa"),...F(y,"other"),required:!0,children:e.jsx(U,{name:"other",control:b,render:({field:s})=>e.jsx(R,{addonAfter:u,prefix:e.jsx(O,{}),...s})})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{...F(y,"total_summa"),children:e.jsx(n,{type:"success",title:c("To'lanayotgan summa").toUpperCase(),value:i(ce),icon:e.jsx(se,{})})})}),e.jsx(x,{xs:24,md:24,children:e.jsx(v.Item,{label:c("Sana"),...F(y,"date"),required:!0,children:e.jsx(U,{name:"date",control:b,render:({field:s})=>e.jsx(Be,{...s})})})})]})})})]})},Ke=()=>{const{t:o}=q(),{id:a}=ie();return[{title:e.jsxs(C,{align:"center",gap:"small",children:[e.jsx(ue,{size:20}),e.jsx("span",{children:o("Savdo")})]})},{title:e.jsx(he,{to:"/trades/trades",children:o("Savdolar")})},{title:a}]},Ct=()=>{const{id:o}=ie(),{t:a}=q(),{data:t,isLoading:l,isError:p,error:u,isFetching:d,refetch:h,isRefetching:c,...L}=ze({queryKey:["trade-one",o],queryFn:()=>Se(o),select:b=>b.data}),B=Ke();return e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx("title",{children:a("Savdo")})}),e.jsxs(S,{gutter:[20,20],children:[e.jsx(x,{span:24,children:e.jsxs(C,{align:"center",justify:"space-between",children:[e.jsx(Ie,{children:a("Savdo")}),e.jsx(ke,{})]})}),e.jsx(x,{span:24,children:e.jsx(_e,{items:B})}),e.jsx(x,{span:24,children:l?e.jsx(qe,{}):e.jsx(e.Fragment,{children:u?e.jsx(Ue,{error:u}):e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:e.jsxs(Fe,{tabPosition:"top",children:[e.jsx(_.TabPane,{tab:a("Umumiy ma'lumotlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(x,{xs:24,md:16,children:e.jsx(K,{children:e.jsxs(C,{vertical:!0,gap:"large",children:[e.jsx(n,{title:a("Mijoz").toUpperCase(),value:r.get(t,"client.name",""),icon:e.jsx(pe,{})}),e.jsx(n,{title:a("Sana").toUpperCase(),value:ne(r.get(t,"date","")),icon:e.jsx(ge,{})}),e.jsx(T,{}),e.jsx(n,{title:a("Mahsulot").toUpperCase(),value:i(r.get(t,"total_product_summa","")),icon:e.jsx(ye,{})}),e.jsx(n,{title:a("Qo'shimcha xizmatlar").toUpperCase(),value:i(r.get(t,"total_service_summa","")),icon:e.jsx(fe,{})}),e.jsx(n,{title:a("Chegirma").toUpperCase(),value:i(r.get(t,"discount_summa","")),icon:e.jsx(se,{})}),e.jsx(n,{title:a("Umumiy summa").toUpperCase(),value:i(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"desc","")?e.jsx(n,{title:a("Izoh").toUpperCase(),value:r.get(t,"desc",""),icon:e.jsx(be,{})}):"",e.jsx(T,{}),e.jsx(n,{title:a("Moderator").toUpperCase(),value:r.get(t,"user",""),icon:e.jsx(ve,{})})]})})}),e.jsx(x,{xs:24,md:8,children:e.jsx(K,{title:e.jsx(ee,{title:a("To'lov ma'lumotlari")}),children:e.jsxs(C,{vertical:!0,gap:"large",children:[e.jsx(n,{title:a("Umumiy summa").toUpperCase(),value:i(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"total_pay","")?e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{margin:"0"}}),e.jsx(n,{title:a("Birinchi to'lov").toUpperCase(),value:i(Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))),icon:e.jsx(Z,{})}),e.jsx(n,{title:a("Naqt").toUpperCase(),value:i(r.get(t,"cash","")),icon:e.jsx(z,{})}),e.jsx(n,{title:a("Karta orqali").toUpperCase(),value:i(r.get(t,"card","")),icon:e.jsx(H,{})}),e.jsx(n,{title:a("Boshqa").toUpperCase(),value:i(r.get(t,"other","")),icon:e.jsx(O,{})})]}):"",e.jsx(T,{style:{margin:"0"}}),e.jsx(n,{title:a("Umumiy to'langan summa").toUpperCase(),value:i(r.get(t,"total_pay","")),icon:e.jsx(W,{})}),e.jsx(n,{title:a("Holati").toUpperCase(),value:r.get(t,"status","")==="Qarzdorlik"?e.jsxs(N,{color:"red",children:[a("Qardorlik")," (",i(r.get(t,"debt_balance","")),")"]}):e.jsx(N,{color:"green",children:a("To'langan")}),icon:e.jsx(Y,{})}),r.get(t,"status","")==="Qarzdorlik"&&e.jsx(te,{summa:r.get(t,"debt_balance",""),refetch:h,item:t})]})})})]})},"1"),e.jsx(_.TabPane,{tab:a("Mahsulotlar"),children:e.jsx(He,{data:r.get(t,"products",[])})},"2"),!r.isEmpty(r.get(t,"services",[])&&e.jsx(_.TabPane,{tab:a("Xizmatlar"),children:e.jsx(Oe,{data:r.get(t,"services",[])})},"3")),Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))!==Number(r.get(t,"total_summa",0))&&e.jsx(_.TabPane,{tab:a("To'lovlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(x,{xs:24,md:16,children:e.jsx(Ve,{data:r.get(t,"payments",[]),refetch:h})}),e.jsx(x,{xs:24,md:8,children:e.jsx(K,{title:e.jsx(ee,{title:a("To'lov ma'lumotlari")}),children:e.jsxs(C,{vertical:!0,gap:"large",children:[e.jsx(n,{title:a("Umumiy summa").toUpperCase(),value:i(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"total_pay","")?e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{margin:"0"}}),e.jsx(n,{title:a("Birinchi to'lov").toUpperCase(),value:i(Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))),icon:e.jsx(Z,{})}),e.jsx(n,{title:a("Naqt").toUpperCase(),value:i(r.get(t,"cash","")),icon:e.jsx(z,{})}),e.jsx(n,{title:a("Karta orqali").toUpperCase(),value:i(r.get(t,"card","")),icon:e.jsx(H,{})}),e.jsx(n,{title:a("Boshqa").toUpperCase(),value:i(r.get(t,"other","")),icon:e.jsx(O,{})})]}):"",e.jsx(T,{style:{margin:"0"}}),e.jsx(n,{title:a("Umumiy to'langan summa").toUpperCase(),value:i(r.get(t,"total_pay","")),icon:e.jsx(W,{})}),e.jsx(n,{title:a("Holati").toUpperCase(),value:r.get(t,"status","")==="Qarzdorlik"?e.jsxs(N,{color:"red",children:[a("Qardorlik")," (",i(r.get(t,"debt_balance","")),")"]}):e.jsx(N,{color:"green",children:a("To'langan")}),icon:e.jsx(Y,{})}),r.get(t,"status","")==="Qarzdorlik"&&e.jsx(te,{summa:r.get(t,"debt_balance",""),refetch:h,item:t})]})})})]})},"4")]})})})})})]})]})};function He({data:o}){const{t:a}=q(),t=[{title:a("#"),dataIndex:"index",key:"index",render:(l,p,u)=>e.jsx(e.Fragment,{children:u+1})},{title:a("Nomi"),dataIndex:"product",key:"product",render:l=>e.jsx(e.Fragment,{children:r.get(l,"name","")})},{title:a("Narxi"),dataIndex:"price",key:"price",render:l=>e.jsx(e.Fragment,{children:i(l)})},{title:a("O'lcham turi"),dataIndex:"size_type",key:"size_type"},{title:a("Miqdori"),dataIndex:"total_count",key:"total_count",render:(l,p)=>e.jsx(e.Fragment,{children:i(l,p.product.format)})}];return e.jsx(V,{title:a("Mahsulotlar"),data:o,columns:t})}function Oe({data:o}){const{t:a}=q(),t=[{title:a("#"),dataIndex:"index",key:"index",render:(l,p,u)=>e.jsx(e.Fragment,{children:u+1})},{title:a("Nomi"),dataIndex:"service",key:"service",render:l=>e.jsx(e.Fragment,{children:r.get(l,"name","")})},{title:a("Narxi"),dataIndex:"price",key:"price",render:l=>e.jsx(e.Fragment,{children:i(l)})},{title:a("Miqdori"),dataIndex:"count",key:"count",render:l=>e.jsx(e.Fragment,{children:i(l,a("ta"))})}];return e.jsx(V,{title:a("Xizmatlar"),data:o,columns:t})}function Ve({data:o,refetch:a}){const{t}=q(),l=ae({mutationFn:Pe,onSuccess:()=>{re(t("Muvaffaqiyatli bajarildi !")),a()},onError:d=>{console.log(d)}}),p=d=>{l.mutate(d)},u=[{title:t("#"),dataIndex:"index",key:"index",render:(d,h,c)=>e.jsx(e.Fragment,{children:c+1})},{title:t("Naqt"),dataIndex:"cash",key:"cash",render:d=>e.jsx(e.Fragment,{children:i(d)})},{title:t("Karta"),dataIndex:"card",key:"card",render:d=>e.jsx(e.Fragment,{children:i(d)})},{title:t("Boshqa"),dataIndex:"other",key:"other",render:d=>e.jsx(e.Fragment,{children:i(d)})},{title:t("Jami summa"),dataIndex:"total",key:"other",render:(d,h)=>e.jsx(e.Fragment,{children:i(h.cash+h.card+h.other)})},{title:t("Sana"),dataIndex:"date",key:"date",render:d=>e.jsx(e.Fragment,{children:ne(d)})},{title:e.jsx(Ce,{size:15}),dataIndex:"id",key:"operation",align:"center",width:50,align:"center",render:d=>e.jsx(C,{align:"center",justify:"space-between",gap:"small",children:e.jsx(Te,{trigger:e.jsx(P,{danger:!0,icon:e.jsx(we,{})}),onOk:()=>p(d)})})}];return e.jsx(V,{title:t("To'lovlar"),data:o,columns:u})}export{Ct as default};
