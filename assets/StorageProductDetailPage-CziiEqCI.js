import{r as U,aw as ce,u as T,au as de,M as ae,a2 as re,j as e,B as N,o as v,aB as o,aG as me,O as F,aD as B,aE as K,aF as H,aC as ue,X as r,at as se,aY as xe,U as he,ar as je,aH as pe,aI as oe,z as ge,aJ as ye,aK as fe,aL as A,aM as be,aN as Ce,y as Y,aO as Z,aP as W,aQ as ve}from"./index-TTKrRBsV.js";import{B as ke}from"./BackButton-BLVW6gZr.js";import{C as ee}from"./CardTitle-WCnvc5ze.js";import{C as V}from"./CustomDataTable-D2IlOEuA.js";import{C as Fe}from"./CustomModalConfirm-DuPb8srr.js";import{P as qe,E as Te}from"./PageLoader-DmyE2ANN.js";import{P as Ie,B as Ue}from"./PageTitle-OKMYAOp7.js";import{T as i}from"./TitleAndIconText-Dlp7yQ8-.js";import{d as _e,e as Pe,c as Ne}from"./storage-products.requests-BGZqPdSR.js";import{u as Se}from"./useQuery-DXHJDm7O.js";import{C as Be}from"./CustomDatePicker-dCRvPDUL.js";import{C as Q}from"./CustomInputNumber-BoiyYvjJ.js";import{C as ze}from"./CustomSwitch-ir5s6zur.js";import{b as Me}from"./storage-products-DKKZrFLu.js";import{c as Ee,a as R,u as De,F as C,C as I,o as Oe}from"./index.esm-Dv3jW_V-.js";import{M as Ae,R as Qe}from"./DeleteFilled-Lrowix85.js";import{R as S,C as u}from"./row-Bxwr5CQq.js";import{C as Re}from"./CustomTabs-DeR7qKEd.js";import{T as _}from"./index-CB8Qoy1w.js";import{C as w}from"./index-Chkbatr3.js";import{D as q}from"./index-CwYkfvr8.js";import{T as P}from"./index-Ce0i5KU3.js";import"./LeftOutlined-30Vtg-fw.js";import"./Table-DaguqWZh.js";import"./index-CRizbU4B.js";import"./index-DVNdkQR1.js";import"./useClosable-CgTQR01w.js";import"./Skeleton-Bgqqq5sk.js";import"./fade-m1HoRkfl.js";import"./PlusOutlined-Ba-GwlE8.js";const te=({summa:l,refetch:a,item:t})=>{var X;const[n,p]=U.useState(!1),{company:{currency_type:x}}=ce(),d=()=>{p(!0)},h=()=>{p(!1)},{t:c}=T(),L=Ee().shape({cash:R().nullable(),card:R().nullable(),other:R().nullable()}).test("one-of-three-required",c("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!"),function(s){const{path:j,createError:m}=this,E=parseFloat(s.cash)||0,D=parseFloat(s.card)||0,O=parseFloat(s.other)||0;return E>0||D>0||O>0?!0:m({path:`${j}.cash`,message:c("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!")})}).test("total-less-than-summa",c("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!"),function(s){const{path:j,createError:m}=this,E=parseFloat(s.cash)||0,D=parseFloat(s.card)||0,O=parseFloat(s.other)||0;return E+D+O<=l?!0:m({path:`${j}.total_summa`,message:c("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!")})}),z=Oe(L),{control:b,formState:{errors:y},handleSubmit:$,setValue:M,getValues:g,watch:f,reset:ie}=De({resolver:z,defaultValues:{date:de(),pay_type:!0}}),{isLoading:G,mutateAsync:ne}=ae({mutationFn:_e,onSuccess:()=>{re(c("Muvaffaqiyatli bajarildi !")),h(),ie(),a()},onError:s=>{console.log(s)}}),J=s=>{ne(Me({...s,storage_product:r.get(t,"id","")}))},k=f("pay_type");U.useEffect(()=>{if(k){const s=g("card")||0,j=g("other")||0,m=l-s-j;m!==g("cash")&&M("cash",m>=0?m:0)}},[l,f("card"),f("other"),k]),U.useEffect(()=>{if(k){const s=g("cash")||0,j=g("other")||0,m=l-s-j;m!==g("card")&&M("card",m>=0?m:0)}},[l,f("cash"),f("other"),k]),U.useEffect(()=>{if(k){const s=g("cash")||0,j=g("card")||0,m=l-s-j;m!==g("other")&&M("other",m>=0?m:0)}},[l,f("cash"),f("card"),k]);const le=f(["cash","card","other"]).reduce((s,j)=>s+(parseFloat(j)||0),0);return e.jsxs(e.Fragment,{children:[e.jsx(N,{onClick:d,type:"primary",children:c("To'lov qilish")}),e.jsx(Ae,{width:400,centered:!0,title:c("To'lov qilish"),open:n,onCancel:h,footer:[e.jsxs(v,{align:"center",gap:"middle",justify:"end",children:[e.jsx(N,{onClick:h,children:c("Bekor qilish")},"cancel"),e.jsx(N,{type:"primary",disabled:G,loading:G,onClick:$(J),children:c("To'lash")},"submit")]})],children:e.jsx(C,{layout:"vertical",onFinish:$(J),style:{margin:"30px 0px"},children:e.jsxs(S,{gutter:[20,15],children:[e.jsx(u,{xs:24,md:24,children:e.jsx(i,{type:"danger",title:c("Qarzdorlik").toUpperCase(),value:o(l),icon:e.jsx(me,{})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{label:c("Barcha qarzdorlikni to'lash"),...F(y,"pay_type"),required:!0,children:e.jsx(I,{name:"pay_type",control:b,render:({field:s})=>e.jsx(ze,{prefix:e.jsx(B,{}),...s})})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{label:c("Naqt"),...F(y,"cash"),required:!0,help:(X=y.cash)==null?void 0:X.message,validateStatus:y.cash?"error":"",children:e.jsx(I,{name:"cash",control:b,render:({field:s})=>e.jsx(Q,{addonAfter:x,prefix:e.jsx(B,{}),...s})})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{label:c("Karta orqali"),...F(y,"card"),required:!0,children:e.jsx(I,{name:"card",control:b,render:({field:s})=>e.jsx(Q,{addonAfter:x,prefix:e.jsx(K,{}),...s})})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{label:c("Boshqa"),...F(y,"other"),required:!0,children:e.jsx(I,{name:"other",control:b,render:({field:s})=>e.jsx(Q,{addonAfter:x,prefix:e.jsx(H,{}),...s})})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{...F(y,"total_summa"),children:e.jsx(i,{type:"success",title:c("To'lanayotgan summa").toUpperCase(),value:o(le),icon:e.jsx(ue,{})})})}),e.jsx(u,{xs:24,md:24,children:e.jsx(C.Item,{label:c("Sana"),...F(y,"date"),required:!0,children:e.jsx(I,{name:"date",control:b,render:({field:s})=>e.jsx(Be,{...s})})})})]})})})]})},we=()=>{const{t:l}=T(),{id:a}=se();return[{title:e.jsxs(v,{align:"center",gap:"small",children:[e.jsx(xe,{size:20}),e.jsx("span",{children:l("Omborxona")})]})},{title:e.jsx(he,{to:"/storages/storage-products",children:l("Omborga mahsulot")})},{title:a}]},vt=()=>{const{id:l}=se(),{t:a}=T(),{data:t,isLoading:n,isError:p,error:x,isFetching:d,refetch:h,isRefetching:c,...L}=Se({queryKey:["storage-product-one",l],queryFn:()=>Ne(l),select:b=>b.data}),z=we();return e.jsxs(e.Fragment,{children:[e.jsx(je,{children:e.jsx("title",{children:a("Omborga mahsulot")})}),e.jsxs(S,{gutter:[20,20],children:[e.jsx(u,{span:24,children:e.jsxs(v,{align:"center",justify:"space-between",children:[e.jsx(Ie,{children:a("Omborga mahsulot")}),e.jsx(ke,{})]})}),e.jsx(u,{span:24,children:e.jsx(Ue,{items:z})}),e.jsx(u,{span:24,children:n?e.jsx(qe,{}):e.jsx(e.Fragment,{children:x?e.jsx(Te,{error:x}):e.jsx(e.Fragment,{children:e.jsx(e.Fragment,{children:e.jsxs(Re,{tabPosition:"top",children:[e.jsx(_.TabPane,{tab:a("Umumiy ma'lumotlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(u,{xs:24,md:16,children:e.jsx(w,{children:e.jsxs(v,{vertical:!0,gap:"large",children:[e.jsx(i,{title:a("Ta'minotchi").toUpperCase(),value:r.get(t,"supplier.name",""),icon:e.jsx(pe,{})}),e.jsx(i,{title:a("Sana").toUpperCase(),value:oe(r.get(t,"date","")),icon:e.jsx(ge,{})}),e.jsx(q,{}),e.jsx(i,{title:a("Mahsulot").toUpperCase(),value:o(r.get(t,"total_product_summa","")),icon:e.jsx(ye,{})}),e.jsx(i,{title:a("Qo'shimcha xizmatlar").toUpperCase(),value:o(r.get(t,"total_service_summa","")),icon:e.jsx(fe,{})}),e.jsx(i,{title:a("Umumiy summa").toUpperCase(),value:o(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"desc","")?e.jsx(i,{title:a("Izoh").toUpperCase(),value:r.get(t,"desc",""),icon:e.jsx(be,{})}):"",e.jsx(q,{}),e.jsx(i,{title:a("Moderator").toUpperCase(),value:r.get(t,"user",""),icon:e.jsx(Ce,{})})]})})}),e.jsx(u,{xs:24,md:8,children:e.jsx(w,{title:e.jsx(ee,{title:a("To'lov ma'lumotlari")}),children:e.jsxs(v,{vertical:!0,gap:"large",children:[e.jsx(i,{title:a("Umumiy summa").toUpperCase(),value:o(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"total_pay","")?e.jsxs(e.Fragment,{children:[e.jsx(q,{style:{margin:"0"}}),e.jsx(i,{title:a("Birinchi to'lov").toUpperCase(),value:o(Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))),icon:e.jsx(Y,{})}),e.jsx(i,{title:a("Naqt").toUpperCase(),value:o(r.get(t,"cash","")),icon:e.jsx(B,{})}),e.jsx(i,{title:a("Karta orqali").toUpperCase(),value:o(r.get(t,"card","")),icon:e.jsx(K,{})}),e.jsx(i,{title:a("Boshqa").toUpperCase(),value:o(r.get(t,"other","")),icon:e.jsx(H,{})})]}):"",e.jsx(q,{style:{margin:"0"}}),e.jsx(i,{title:a("Umumiy to'langan summa").toUpperCase(),value:o(r.get(t,"total_pay","")),icon:e.jsx(Z,{})}),e.jsx(i,{title:a("Holati").toUpperCase(),value:r.get(t,"status","")==="Qarzdorlik"?e.jsxs(P,{color:"red",children:[a("Qardorlik")," (",o(r.get(t,"debt_balance","")),")"]}):e.jsx(P,{color:"green",children:a("To'langan")}),icon:e.jsx(W,{})}),r.get(t,"status","")==="Qarzdorlik"&&e.jsx(te,{summa:r.get(t,"debt_balance",""),refetch:h,item:t})]})})})]})},"1"),e.jsx(_.TabPane,{tab:a("Mahsulotlar"),children:e.jsx(Ke,{data:r.get(t,"products",[])})},"2"),!r.isEmpty(r.get(t,"services",[])&&e.jsx(_.TabPane,{tab:a("Xizmatlar"),children:e.jsx(He,{data:r.get(t,"services",[])})},"3")),Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))!==Number(r.get(t,"total_summa",0))&&e.jsx(_.TabPane,{tab:a("To'lovlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(u,{xs:24,md:16,children:e.jsx(Ve,{data:r.get(t,"payments",[]),refetch:h})}),e.jsx(u,{xs:24,md:8,children:e.jsx(w,{title:e.jsx(ee,{title:a("To'lov ma'lumotlari")}),children:e.jsxs(v,{vertical:!0,gap:"large",children:[e.jsx(i,{title:a("Umumiy summa").toUpperCase(),value:o(r.get(t,"total_summa","")),icon:e.jsx(A,{})}),r.get(t,"total_pay","")?e.jsxs(e.Fragment,{children:[e.jsx(q,{style:{margin:"0"}}),e.jsx(i,{title:a("Birinchi to'lov").toUpperCase(),value:o(Number(r.get(t,"cash",0))+Number(r.get(t,"card",0))+Number(r.get(t,"other",0))),icon:e.jsx(Y,{})}),e.jsx(i,{title:a("Naqt").toUpperCase(),value:o(r.get(t,"cash","")),icon:e.jsx(B,{})}),e.jsx(i,{title:a("Karta orqali").toUpperCase(),value:o(r.get(t,"card","")),icon:e.jsx(K,{})}),e.jsx(i,{title:a("Boshqa").toUpperCase(),value:o(r.get(t,"other","")),icon:e.jsx(H,{})})]}):"",e.jsx(q,{style:{margin:"0"}}),e.jsx(i,{title:a("Umumiy to'langan summa").toUpperCase(),value:o(r.get(t,"total_pay","")),icon:e.jsx(Z,{})}),e.jsx(i,{title:a("Holati").toUpperCase(),value:r.get(t,"status","")==="Qarzdorlik"?e.jsxs(P,{color:"red",children:[a("Qardorlik")," (",o(r.get(t,"debt_balance","")),")"]}):e.jsx(P,{color:"green",children:a("To'langan")}),icon:e.jsx(W,{})}),r.get(t,"status","")==="Qarzdorlik"&&e.jsx(te,{summa:r.get(t,"debt_balance",""),refetch:h,item:t})]})})})]})},"4")]})})})})})]})]})};function Ke({data:l}){const{t:a}=T(),t=[{title:a("#"),dataIndex:"index",key:"index",render:(n,p,x)=>e.jsx(e.Fragment,{children:x+1})},{title:a("Nomi"),dataIndex:"product",key:"product",render:n=>e.jsx(e.Fragment,{children:r.get(n,"name","")})},{title:a("Narxi"),dataIndex:"price",key:"price",render:n=>e.jsx(e.Fragment,{children:o(n)})},{title:a("O'lcham turi"),dataIndex:"size_type",key:"size_type"},{title:a("Miqdori"),dataIndex:"total_count",key:"total_count",render:(n,p)=>e.jsx(e.Fragment,{children:o(n,p.product.format)})},{title:a("Ombor"),dataIndex:"storage",key:"storage",render:n=>e.jsx(e.Fragment,{children:r.get(n,"name","")})}];return e.jsx(V,{title:a("Mahsulotlar"),data:l,columns:t})}function He({data:l}){const{t:a}=T(),t=[{title:a("#"),dataIndex:"index",key:"index",render:(n,p,x)=>e.jsx(e.Fragment,{children:x+1})},{title:a("Nomi"),dataIndex:"service",key:"service",render:n=>e.jsx(e.Fragment,{children:r.get(n,"name","")})},{title:a("Narxi"),dataIndex:"price",key:"price",render:n=>e.jsx(e.Fragment,{children:o(n)})},{title:a("Miqdori"),dataIndex:"count",key:"count",render:n=>e.jsx(e.Fragment,{children:o(n,a("ta"))})}];return e.jsx(V,{title:a("Xizmatlar"),data:l,columns:t})}function Ve({data:l,refetch:a}){const{t}=T(),n=ae({mutationFn:Pe,onSuccess:()=>{re(t("Muvaffaqiyatli bajarildi !")),a()},onError:d=>{console.log(d)}}),p=d=>{n.mutate(d)},x=[{title:t("#"),dataIndex:"index",key:"index",render:(d,h,c)=>e.jsx(e.Fragment,{children:c+1})},{title:t("Naqt"),dataIndex:"cash",key:"cash",hidden:!0,render:d=>e.jsx(e.Fragment,{children:o(d)})},{title:t("Karta"),dataIndex:"card",key:"card",hidden:!0,render:d=>e.jsx(e.Fragment,{children:o(d)})},{title:t("Boshqa"),dataIndex:"other",key:"other",hidden:!0,render:d=>e.jsx(e.Fragment,{children:o(d)})},{title:t("Jami summa"),dataIndex:"total",key:"total",render:(d,h)=>e.jsx(e.Fragment,{children:o(h.cash+h.card+h.other)})},{title:t("Sana"),dataIndex:"date",key:"date",render:d=>e.jsx(e.Fragment,{children:oe(d)})},{title:e.jsx(ve,{size:15}),dataIndex:"id",key:"operation",align:"center",width:50,align:"center",render:d=>e.jsx(v,{align:"center",justify:"space-between",gap:"small",children:e.jsx(Fe,{trigger:e.jsx(N,{danger:!0,icon:e.jsx(Qe,{})}),onOk:()=>p(d)})})}];return e.jsx(V,{title:t("To'lovlar"),data:l,columns:x})}export{vt as default};
