import{r as f,aw as le,u as v,au as ce,M as te,a2 as ae,j as e,B as R,o as y,aB as E,aG as de,O as b,aD as X,aE as Ae,aF as he,aC as ge,X as i,at as re,aS as me,U as se,ar as xe,aH as ue,k as je,aJ as Ee,aI as ne,z as pe,aM as Qe,aL as O,aP as V,l as Ce,aq as Be,aQ as fe}from"./index-TTKrRBsV.js";import{B as ye}from"./BackButton-BLVW6gZr.js";import{G as Ie,C as ke}from"./GlobalSearchInput-D1DeoeWx.js";import{C as be}from"./CreateButton-xdDnGHH7.js";import{C as Se}from"./CustomTabs-DeR7qKEd.js";import{C as W}from"./CardTitle-WCnvc5ze.js";import{C as ie}from"./CustomDataTable-D2IlOEuA.js";import{C as Ne}from"./CustomModalConfirm-DuPb8srr.js";import{P as Fe,E as Te}from"./PageLoader-DmyE2ANN.js";import{P as ve,B as ze}from"./PageTitle-OKMYAOp7.js";import{T as j}from"./TitleAndIconText-Dlp7yQ8-.js";import{u as Je}from"./useTradeColumns-D2oMPL4z.js";import{e as Ke,f as Re}from"./clients.requests-DE0ZkmW1.js";import{h as Ue,e as qe}from"./trade.requests-D_bujT-q.js";import{u as oe}from"./useQuery-DXHJDm7O.js";import{C as Me}from"./CustomDatePicker-dCRvPDUL.js";import{C as w}from"./CustomInputNumber-BoiyYvjJ.js";import{C as Pe}from"./CustomSwitch-ir5s6zur.js";import{a as De}from"./clients-CQEBpeJ1.js";import{c as He,a as L,u as Ye,F as k,C as T,o as we}from"./index.esm-Dv3jW_V-.js";import{M as Le,R as Ze}from"./DeleteFilled-Lrowix85.js";import{R as S,C as l}from"./row-Bxwr5CQq.js";import{T as Z}from"./index-CB8Qoy1w.js";import{C as G}from"./index-Chkbatr3.js";import{I as _}from"./index-COnZReZT.js";import{D as $}from"./index-CwYkfvr8.js";import{T as K}from"./index-Ce0i5KU3.js";import"./LeftOutlined-30Vtg-fw.js";import"./index-CRizbU4B.js";import"./PlusOutlined-Ba-GwlE8.js";import"./Table-DaguqWZh.js";import"./index-DVNdkQR1.js";import"./useClients-CTLUVbG-.js";import"./index-Jp31-sNK.js";import"./CheckUI-V7eYEVCD.js";import"./EyeFilled-oI1XtQGU.js";import"./PrinterOutlined-DYf3p5xo.js";import"./EditFilled-96y0AoAx.js";import"./useClosable-CgTQR01w.js";import"./Skeleton-Bgqqq5sk.js";import"./fade-m1HoRkfl.js";const ee=({summa:o,refetch:r,item:t})=>{var A;const[g,C]=f.useState(!1),{company:{currency_type:h}}=le(),s=()=>{C(!0)},c=()=>{C(!1)},{t:n}=v(),m=He().shape({cash:L().nullable(),card:L().nullable(),other:L().nullable()}).test("one-of-three-required",n("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!"),function(a){const{path:u,createError:d}=this,D=parseFloat(a.cash)||0,H=parseFloat(a.card)||0,Y=parseFloat(a.other)||0;return D>0||H>0||Y>0?!0:d({path:`${u}.cash`,message:n("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!")})}).test("total-less-than-summa",n("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!"),function(a){const{path:u,createError:d}=this,D=parseFloat(a.cash)||0,H=parseFloat(a.card)||0,Y=parseFloat(a.other)||0;return D+H+Y<=o?!0:d({path:`${u}.total_summa`,message:n("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!")})}),N=we(m),{control:B,formState:{errors:p},handleSubmit:U,setValue:F,getValues:x,watch:Q,reset:q}=Ye({resolver:N,defaultValues:{date:ce(),pay_type:!0}}),{isLoading:z,mutateAsync:M}=te({mutationFn:Ke,onSuccess:()=>{ae(n("Muvaffaqiyatli bajarildi !")),c(),q(),r()},onError:a=>{console.log(a)}}),J=a=>{M(De({...a,client:i.get(t,"id","")}))},I=Q("pay_type");f.useEffect(()=>{if(I){const a=x("card")||0,u=x("other")||0,d=o-a-u;d!==x("cash")&&F("cash",d>=0?d:0)}},[o,Q("card"),Q("other"),I]),f.useEffect(()=>{if(I){const a=x("cash")||0,u=x("other")||0,d=o-a-u;d!==x("card")&&F("card",d>=0?d:0)}},[o,Q("cash"),Q("other"),I]),f.useEffect(()=>{if(I){const a=x("cash")||0,u=x("card")||0,d=o-a-u;d!==x("other")&&F("other",d>=0?d:0)}},[o,Q("cash"),Q("card"),I]);const P=Q(["cash","card","other"]).reduce((a,u)=>a+(parseFloat(u)||0),0);return e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:s,type:"primary",children:n("To'lov qilish")}),e.jsx(Le,{width:400,centered:!0,title:n("To'lov qilish"),open:g,onCancel:c,footer:[e.jsxs(y,{align:"center",gap:"middle",justify:"end",children:[e.jsx(R,{onClick:c,children:n("Bekor qilish")},"cancel"),e.jsx(R,{type:"primary",disabled:z,loading:z,onClick:U(J),children:n("To'lash")},"submit")]})],children:e.jsx(k,{layout:"vertical",onFinish:U(J),style:{margin:"30px 0px"},children:e.jsxs(S,{gutter:[20,15],children:[e.jsx(l,{xs:24,md:24,children:e.jsx(j,{type:"danger",title:n("Qarzdorlik").toUpperCase(),value:E(o),icon:e.jsx(de,{})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{label:n("Barcha qarzdorlikni to'lash"),...b(p,"pay_type"),required:!0,children:e.jsx(T,{name:"pay_type",control:B,render:({field:a})=>e.jsx(Pe,{prefix:e.jsx(X,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{label:n("Naqt"),...b(p,"cash"),required:!0,help:(A=p.cash)==null?void 0:A.message,validateStatus:p.cash?"error":"",children:e.jsx(T,{name:"cash",control:B,render:({field:a})=>e.jsx(w,{addonAfter:h,prefix:e.jsx(X,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{label:n("Karta orqali"),...b(p,"card"),required:!0,children:e.jsx(T,{name:"card",control:B,render:({field:a})=>e.jsx(w,{addonAfter:h,prefix:e.jsx(Ae,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{label:n("Boshqa"),...b(p,"other"),required:!0,children:e.jsx(T,{name:"other",control:B,render:({field:a})=>e.jsx(w,{addonAfter:h,prefix:e.jsx(he,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{...b(p,"total_summa"),children:e.jsx(j,{type:"success",title:n("To'lanayotgan summa").toUpperCase(),value:E(P),icon:e.jsx(ge,{})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(k.Item,{label:n("Sana"),...b(p,"date"),required:!0,children:e.jsx(T,{name:"date",control:B,render:({field:a})=>e.jsx(Me,{...a})})})})]})})})]})},Ge=()=>{const{t:o}=v(),{id:r}=re();return[{title:e.jsxs(y,{align:"center",gap:"small",children:[e.jsx(me,{size:20}),e.jsx("span",{children:o("Mijozlar")})]})},{title:e.jsx(se,{to:"/clients/clients",children:o("Mijozlar")})},{title:r}]},Ut=()=>{const{id:o}=re(),{t:r}=v(),{data:t,isLoading:g,isError:C,error:h,isFetching:s,refetch:c,isRefetching:n,...m}=oe({queryKey:["client-one",o],queryFn:()=>Re(o),select:B=>B.data}),N=Ge();return e.jsxs(e.Fragment,{children:[e.jsx(xe,{children:e.jsx("title",{children:r("Mijoz")})}),e.jsxs(S,{gutter:[20,20],children:[e.jsx(l,{span:24,children:e.jsxs(y,{align:"center",justify:"space-between",children:[e.jsx(ve,{children:r("Mijoz")}),e.jsx(ye,{})]})}),e.jsx(l,{span:24,children:e.jsx(ze,{items:N})}),e.jsx(l,{span:24,children:g?e.jsx(Fe,{}):e.jsx(e.Fragment,{children:h?e.jsx(Te,{error:h}):e.jsx(e.Fragment,{children:e.jsxs(Se,{tabPosition:"top",children:[e.jsx(Z.TabPane,{tab:r("Umumiy ma'lumotlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(l,{xs:24,md:16,children:e.jsx(G,{children:e.jsxs(y,{vertical:!0,gap:"large",children:[e.jsx(j,{title:r("Mijoz").toUpperCase(),value:i.get(t,"name",""),icon:e.jsx(ue,{})}),e.jsx(j,{title:r("Telefon").toUpperCase(),value:i.get(t,"phone",""),icon:e.jsx(je,{})}),e.jsx(j,{title:r("Mijoz turi").toUpperCase(),value:i.get(t,"client_type",""),icon:e.jsx(Ee,{})}),e.jsx(j,{title:r("Sana").toUpperCase(),value:ne(i.get(t,"added","")),icon:e.jsx(pe,{})}),i.get(t,"desc","")?e.jsx(j,{title:r("Izoh").toUpperCase(),value:i.get(t,"desc",""),icon:e.jsx(Qe,{})}):"",e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(_,{width:"100%",src:i.get(t,"image",""),alt:"Client Image",placeholder:e.jsx(_,{preview:!1,src:"https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png?x-oss-process=image/blur,r_50,s_50/quality,q_1/resize,m_mfit,h_200,w_200",width:"100%"}),fallback:"data:image/png;base64,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"})})]})})}),e.jsx(l,{xs:24,md:8,children:e.jsx(G,{title:e.jsx(W,{title:r("To'lov ma'lumotlari")}),children:e.jsxs(y,{vertical:!0,gap:"large",children:[e.jsx(j,{title:r("Qarzdorlik").toUpperCase(),value:E(i.get(t,"debt_balance",0)),icon:e.jsx(O,{})}),e.jsx($,{style:{margin:"0"}}),e.jsx(j,{title:r("Holati").toUpperCase(),value:i.get(t,"status","")==="Qarzdorlik"?e.jsxs(K,{color:"red",children:[r("Qardorlik")," (",E(i.get(t,"debt_balance","")),")"]}):e.jsx(K,{color:"green",children:r("To'langan")}),icon:e.jsx(V,{})}),i.get(t,"status","")==="Qarzdorlik"&&e.jsx(ee,{summa:i.get(t,"debt_balance",""),refetch:c,item:t})]})})})]})},"1"),e.jsx(Z.TabPane,{tab:r("Savdolar"),children:e.jsx(Xe,{client:i.get(t,"id",""),clientRefetch:c})},"2"),e.jsx(Z.TabPane,{tab:r("To'lovlar"),children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(l,{xs:24,md:16,children:e.jsx(Oe,{data:i.get(t,"payments",[]),refetch:c})}),e.jsx(l,{xs:24,md:8,children:e.jsx(G,{title:e.jsx(W,{title:r("To'lov ma'lumotlari")}),children:e.jsxs(y,{vertical:!0,gap:"large",children:[e.jsx(j,{title:r("Qarzdorlik").toUpperCase(),value:E(i.get(t,"debt_balance",0)),icon:e.jsx(O,{})}),e.jsx($,{style:{margin:"0"}}),e.jsx(j,{title:r("Holati").toUpperCase(),value:i.get(t,"status","")==="Qarzdorlik"?e.jsxs(K,{color:"red",children:[r("Qardorlik")," (",E(i.get(t,"debt_balance","")),")"]}):e.jsx(K,{color:"green",children:r("To'langan")}),icon:e.jsx(V,{})}),i.get(t,"status","")==="Qarzdorlik"&&e.jsx(ee,{summa:i.get(t,"debt_balance",""),refetch:c,item:t})]})})})]})},"4")]})})})})]})]})},Xe=({client:o,clientRefetch:r})=>{v();const t=Ce(),[g,C]=f.useState({current:1,pageSize:10,total:null}),[h,s]=f.useState({}),[c,n]=f.useState(""),{data:m,isLoading:N,isError:B,error:p,isFetching:U,refetch:F,isRefetching:x,...Q}=oe({queryKey:["storage-products",{page:g.current,pageSize:g.pageSize,filters:h}],queryFn:()=>Ue(g.current,g.pageSize,Be({client:o,...h})),select:A=>A.data,keepPreviousData:!0});f.useEffect(()=>{m&&C(A=>({...A,current:m.current||1,pageSize:m.pageSize||10,total:m.total||""}))},[m]);const q=(A,a)=>{C({...A}),s(a)},z=()=>{s({}),n("")},M=A=>{s({...h,search:A})},J=A=>{n(A.target.value)},P=Je(g,h,s,()=>{F(),r()}).filter(A=>A.key!=="client");return e.jsx(e.Fragment,{children:e.jsx(S,{gutter:[20,20],children:e.jsx(l,{span:24,children:e.jsxs(S,{gutter:[20,20],children:[e.jsx(l,{xs:24,sm:24,md:24,lg:6,xl:6,children:e.jsx(Ie,{value:c,enterButton:!0,onSearch:M,onChange:J})}),e.jsx(l,{xs:24,sm:24,md:24,lg:18,xl:18,children:e.jsxs(y,{align:"center",justify:"end",gap:"middle",children:[e.jsx(ke,{onClick:z}),e.jsx(be,{onClick:()=>t("/trades/trade-create")})]})}),e.jsx(l,{span:24,children:e.jsx(ie,{columns:P,data:(m==null?void 0:m.results)||[],pagination:g,loading:N||x,onChange:q})})]})})})})};function Oe({data:o,refetch:r}){const{t}=v(),g=te({mutationFn:qe,onSuccess:()=>{ae(t("Muvaffaqiyatli bajarildi !")),r()},onError:s=>{console.log(s)}}),C=s=>{g.mutate(s)},h=[{title:t("#"),dataIndex:"index",key:"index",render:(s,c,n)=>e.jsx(e.Fragment,{children:n+1})},{title:t("Savdo"),dataIndex:"trade",key:"trade",render:s=>e.jsx(e.Fragment,{children:e.jsx(se,{to:`/trades/trades/${s}`,children:t("Ko'rish")})})},{title:t("Naqt"),dataIndex:"cash",key:"cash",hidden:!0,render:s=>e.jsx(e.Fragment,{children:E(s)})},{title:t("Karta"),dataIndex:"card",key:"card",hidden:!0,render:s=>e.jsx(e.Fragment,{children:E(s)})},{title:t("Boshqa"),dataIndex:"other",key:"other",hidden:!0,render:s=>e.jsx(e.Fragment,{children:E(s)})},{title:t("Jami summa"),dataIndex:"total",key:"total",render:(s,c)=>e.jsx(e.Fragment,{children:E(c.cash+c.card+c.other)})},{title:t("Sana"),dataIndex:"date",key:"date",render:s=>e.jsx(e.Fragment,{children:ne(s)})},{title:e.jsx(fe,{size:15}),dataIndex:"id",key:"operation",align:"center",width:50,align:"center",render:s=>e.jsx(y,{align:"center",justify:"space-between",gap:"small",children:e.jsx(Ne,{trigger:e.jsx(R,{danger:!0,icon:e.jsx(Ze,{})}),onOk:()=>C(s)})})}];return e.jsx(ie,{title:t("To'lovlar"),data:o,columns:h})}export{Ut as default};
