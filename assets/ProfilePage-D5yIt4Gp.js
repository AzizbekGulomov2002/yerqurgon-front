import{u as v,r as q,j as e,O as b,o as T,B as C,M as I,e9 as H,a2 as E,Z as V,a0 as Q,V as X,X as x,at as G,e7 as Y,l as Z,ar as J,aH as W,ea as ee,k as se,F as re,eb as te,S as B,ec as ae,as as D,ed as ie,ee as ne}from"./index-TTKrRBsV.js";import{C as oe}from"./CustomTabs-DeR7qKEd.js";import{C as le,a as N}from"./CustomPhoneInput-Dyz5Xq3R.js";import{P as de,E as ce}from"./PageLoader-DmyE2ANN.js";import{P as me,B as xe}from"./PageTitle-OKMYAOp7.js";import{T as F}from"./TitleAndIconText-Dlp7yQ8-.js";import{c as U,a as P,u as z,F as d,C as w,o as R,b as ue}from"./index.esm-Dv3jW_V-.js";import{u as he}from"./useQuery-DXHJDm7O.js";import{C as O}from"./CustomInput-CfXd1HaZ.js";import{u as je}from"./useClientTypes-BFb73J4y.js";import{R as f,C as i}from"./row-Bxwr5CQq.js";import{D as ge}from"./index-CwYkfvr8.js";import{C as pe}from"./index.es-D5aqwRbg.js";import{C as M}from"./index-Chkbatr3.js";import{I as fe}from"./index-CRizbU4B.js";import{T as _}from"./index-CB8Qoy1w.js";import"./index-DNWE43hh.js";import"./index-DVNdkQR1.js";import"./Skeleton-Bgqqq5sk.js";import"./PlusOutlined-Ba-GwlE8.js";const ye=({defaultValues:s,handleSubmit:t,actionLoading:l=!1,readOnly:c=!1})=>{const{t:a}=v(),j=U().shape({first_name:P().required(a("Ism kiritilishi kerak !")),last_name:P().required(a("Familiya kiritilishi kerak !")),username:P().required(a("Telefon raqam kiritilishi kerak !"))}),u=R(j);je();const{control:n,formState:{errors:m},reset:g,watch:p,...h}=z({defaultValues:{...s},resolver:u});q.useEffect(()=>{g(s)},[s]);const S=()=>g({}),y=h.handleSubmit(r=>{t(r,S)});return e.jsxs(d,{layout:"vertical",className:"create-form",name:"create-form",size:"large",onFinish:y,children:[e.jsxs(f,{gutter:[20,20],children:[e.jsx(i,{xs:24,md:6,children:e.jsx(d.Item,{label:a("Ism"),...b(m,"first_name"),required:!0,children:e.jsx(w,{name:"first_name",control:n,render:({field:r})=>e.jsx(O,{...r})})})}),e.jsx(i,{xs:24,md:6,children:e.jsx(d.Item,{label:a("Familiya"),...b(m,"last_name"),required:!0,children:e.jsx(w,{name:"last_name",control:n,render:({field:r})=>e.jsx(O,{...r})})})}),e.jsx(i,{xs:24,md:6,children:e.jsx(d.Item,{label:a("Telefon raqam"),...b(m,"username"),required:!0,children:e.jsx(w,{name:"username",control:n,render:({field:r})=>e.jsx(le,{...r})})})})]}),e.jsx(ge,{}),e.jsx(d.Item,{children:e.jsx(T,{align:"center",justify:"end",gap:"middle",children:e.jsx(C,{type:"primary",htmlType:"submit",loading:l,disabled:l,children:a("O'zgartirish")})})})]})},{Title:A,Text:be}=X,Pe=({resetPassword:s,user_email:t,setStep:l})=>{const{t:c}=v(),[a,j]=q.useState(Date.now()+18e4),u=U().shape({verification_code:P().required(c("Kod kiritilishi kerak !"))}),{handleSubmit:n,control:m,getValues:g,formState:{errors:p}}=z({defaultValues:{},resolver:R(u)}),h=I({mutationKey:["reset-password"],mutationFn:H,onSuccess:r=>{s(),E(c("Parol muvaffaqiyatli o'zgartirildi !")),l("change")},onError:r=>{console.log(r)}}),S=r=>{const o={verification_code:Number(x.get(r,"verification_code",""))};h.mutateAsync(o)},y=({hours:r,minutes:o,seconds:k,completed:K})=>{if(K)return l("change"),null;const L=String(o).padStart(2,"0"),$=String(k).padStart(2,"0");return e.jsxs("span",{children:[L,":",$]})};return e.jsx(e.Fragment,{children:e.jsx(M,{children:e.jsx(f,{gutter:[0,24],children:e.jsx(i,{xs:24,md:6,children:e.jsx(d,{layout:"vertical",className:"login-form",name:"login-form",size:"large",onFinish:n(S),children:e.jsxs(f,{gutter:[15,15],children:[e.jsx(i,{xs:24,md:24,children:e.jsxs(T,{align:"center",justify:"center",vertical:!0,children:[e.jsx(A,{level:3,children:c("Tasdiqlash")}),e.jsx(be,{level:5,align:"center",children:V.language==="uz"?e.jsxs(e.Fragment,{children:["Tasdiqlash kodi ",e.jsx("b",{children:t})," ga yuborildi."," ",e.jsx("br",{}),"Iltimos tasdiqlash kodini kiriting !"]}):V.language=="en"?e.jsxs(e.Fragment,{children:["Verification code sent to ",e.jsx("b",{children:t}),". ",e.jsx("br",{}),"Please enter the verification code!"]}):e.jsxs(e.Fragment,{children:["Код подтверждения отправлен на адрес"," ",e.jsx("b",{children:t}),". ",e.jsx("br",{}),"Пожалуйста, введите проверочный код!"]})})]})}),e.jsx(i,{xs:24,md:24,children:e.jsx(d.Item,{style:{display:"flex",alignItems:"center",justifyContent:"center"},...b(p,"verification_code"),required:!0,children:e.jsx(w,{name:"verification_code",control:m,render:({field:r})=>e.jsx(fe.OTP,{...r,length:4,prefix:e.jsx(Q,{})})})})}),e.jsx(i,{xs:24,md:24,children:e.jsx(d.Item,{children:e.jsx(C,{style:{width:"100%",marginTop:"10px"},type:"primary",htmlType:"submit",loading:h.isLoading||h.isPending,disabled:h.isLoading||h.isPending,children:c("Tasdiqlash")})})}),e.jsx(i,{xs:24,md:24,children:e.jsx(T,{align:"center",justify:"center",children:e.jsx(A,{level:5,children:e.jsx(pe,{date:a,renderer:y})})})})]})})})})})})},we=()=>{const{t:s}=v();return G(),[{title:e.jsxs(T,{align:"center",gap:"small",children:[e.jsx(Y,{size:20}),e.jsx("span",{children:s("Sozlamalar")})]})},{title:e.jsx(e.Fragment,{children:s("Profil")})}]},$e=()=>{const{t:s}=v();Z();const{data:t,isLoading:l,isError:c,error:a,isFetching:j,refetch:u,isRefetching:n,...m}=he({queryKey:["me"],queryFn:()=>ne(),select:p=>p.data}),g=we();return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsx("title",{children:s("Profil")})}),e.jsxs(f,{gutter:[20,20],children:[e.jsx(i,{span:24,children:e.jsx(T,{align:"center",justify:"space-between",children:e.jsx(me,{children:s("Profil")})})}),e.jsx(i,{span:24,children:e.jsx(xe,{items:g})}),e.jsx(i,{span:24,children:l?e.jsx(de,{}):e.jsx(e.Fragment,{children:a?e.jsx(ce,{error:a}):e.jsx(e.Fragment,{children:e.jsxs(oe,{tabPosition:"top",children:[e.jsx(_.TabPane,{tab:s("Hisob ma'lumotlari"),children:e.jsx(f,{gutter:[20,20],children:e.jsx(i,{xs:24,md:24,children:e.jsx(M,{children:e.jsxs(T,{vertical:!0,gap:"large",children:[e.jsx(F,{title:s("Ism").toUpperCase(),value:x.get(t,"first_name",""),icon:e.jsx(W,{})}),e.jsx(F,{title:s("Familiya").toUpperCase(),value:x.get(t,"last_name",""),icon:e.jsx(ee,{})}),e.jsx(F,{title:s("Telefon raqami").toUpperCase(),value:x.get(t,"username",""),icon:e.jsx(se,{})}),e.jsx(F,{title:s("Email").toUpperCase(),value:x.get(t,"email",""),icon:e.jsx(re,{})}),e.jsx(F,{title:s("Rol").toUpperCase(),value:x.get(t,"role",""),icon:e.jsx(te,{})})]})})})})},"1"),e.jsx(_.TabPane,{tab:s("Ma'lumotlarni o'zgartirish"),children:e.jsx(Te,{user:t,refetch:u})},"2"),e.jsx(_.TabPane,{tab:s("Parolni o'zgartirish"),children:e.jsx(ve,{})},"3")]})})})})]})]})},Te=({user:s,refetch:t})=>{const{t:l}=v(),c=()=>{D(),E(l("Muvaffaqiyatli bajarildi !")),t()},{isPending:a,mutateAsync:j}=I({mutationFn:ae,onSuccess:c,onError:n=>{D(),console.log(n)}}),u=async(n,m)=>{j({first_name:x.get(n,"first_name",""),last_name:x.get(n,"last_name",""),username:x.get(n,"username","")})};return e.jsx(e.Fragment,{children:e.jsx(ye,{handleSubmit:u,defaultValues:s,actionLoading:a})})},ve=()=>{const{t:s}=v(),[t,l]=q.useState("change"),[c,a]=q.useState(null),j=U().shape({new_password:P().required(s("Parol kiritilishi kerak !")),new_password2:P().oneOf([ue("new_password"),null],s("Parollar mos kelishi kerak !")).required(s("Parolni qayta kiriting !"))}),u=I({mutationKey:["forgot-password"],mutationFn:ie,onSuccess:o=>{E(s("Emailga tasdiqlash kodi yuborildi !")),l("verify"),a(o.data.email)},onError:o=>{console.log(o)}}),{mutateAsync:n,isPending:m}=u,{handleSubmit:g,control:p,getValues:h,reset:S,formState:{errors:y}}=z({defaultValues:{},resolver:R(j)}),r=o=>{const k={new_password:x.get(o,"new_password","")};n(k)};return e.jsx(e.Fragment,{children:t==="verify"?e.jsx(Pe,{setStep:l,user_email:c,resetPassword:S}):e.jsx(M,{children:e.jsx(f,{gutter:[0,24],children:e.jsx(i,{xs:24,md:6,children:e.jsx(d,{layout:"vertical",className:"login-form",name:"login-form",size:"large",onFinish:g(r),children:e.jsxs(f,{gutter:[15,15],children:[e.jsx(i,{xs:24,md:24,children:e.jsx(d.Item,{label:s("Yangi parol"),...b(y,"new_password"),required:!0,children:e.jsx(w,{name:"new_password",control:p,render:({field:o})=>e.jsx(N,{...o,placeholder:s("Parolni kiriting"),prefix:e.jsx(B,{})})})})}),e.jsx(i,{xs:24,md:24,children:e.jsx(d.Item,{label:s("Parolni tasdiqlang"),...b(y,"new_password2"),required:!0,children:e.jsx(w,{name:"new_password2",control:p,render:({field:o})=>e.jsx(N,{...o,placeholder:s("Parolni qayta kiriting"),prefix:e.jsx(B,{})})})})}),e.jsx(i,{xs:24,md:24,children:e.jsx(d.Item,{children:e.jsx(C,{style:{width:"100%",marginTop:"10px"},type:"primary",htmlType:"submit",loading:m,disabled:m,children:s("O'zgartirish")})})})]})})})})})})};export{$e as default};
