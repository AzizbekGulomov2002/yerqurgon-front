import{r as k,aw as ie,u as E,au as le,M as ee,a2 as te,j as e,B as D,o as T,aB as f,aG as ce,O as q,aD as $,aE as de,aF as he,aC as me,X as n,at as ae,aY as ue,U as re,ar as pe,aH as xe,k as je,aJ as ge,aI as se,z as fe,aM as ye,aL as J,aP as W,l as Ce,aq as be,aQ as Se}from"./index-TTKrRBsV.js";import{B as ke}from"./BackButton-BLVW6gZr.js";import{G as Te,C as Fe}from"./GlobalSearchInput-D1DeoeWx.js";import{C as ve}from"./CreateButton-xdDnGHH7.js";import{C as qe}from"./CustomTabs-DeR7qKEd.js";import{C as X}from"./CardTitle-WCnvc5ze.js";import{C as oe}from"./CustomDataTable-D2IlOEuA.js";import{C as Pe}from"./CustomModalConfirm-DuPb8srr.js";import{P as Ie,E as ze}from"./PageLoader-DmyE2ANN.js";import{P as Be,B as Ee}from"./PageTitle-OKMYAOp7.js";import{T as g}from"./TitleAndIconText-Dlp7yQ8-.js";import{u as _e}from"./useStorageProductColumns-DgNlyPgt.js";import{h as Ue,e as Me}from"./storage-products.requests-BGZqPdSR.js";import{e as De,f as Re}from"./suppliers.requests-CZGt-cgQ.js";import{u as ne}from"./useQuery-DXHJDm7O.js";import{C as Qe}from"./CustomDatePicker-dCRvPDUL.js";import{C as K}from"./CustomInputNumber-BoiyYvjJ.js";import{C as Ae}from"./CustomSwitch-ir5s6zur.js";import{a as Ne}from"./suppliers-B1x7mLyS.js";import{c as Oe,a as G,u as Le,F as v,C as B,o as we}from"./index.esm-Dv3jW_V-.js";import{M as Ke,R as Ge}from"./DeleteFilled-Lrowix85.js";import{R as P,C as l}from"./row-Bxwr5CQq.js";import{T as H}from"./index-CB8Qoy1w.js";import{C as V}from"./index-Chkbatr3.js";import{D as Y}from"./index-CwYkfvr8.js";import{T as M}from"./index-Ce0i5KU3.js";import"./LeftOutlined-30Vtg-fw.js";import"./index-CRizbU4B.js";import"./PlusOutlined-Ba-GwlE8.js";import"./Table-DaguqWZh.js";import"./index-DVNdkQR1.js";import"./useSuppliers-Bt7n3lGa.js";import"./EyeFilled-oI1XtQGU.js";import"./EditFilled-96y0AoAx.js";import"./useClosable-CgTQR01w.js";import"./Skeleton-Bgqqq5sk.js";import"./fade-m1HoRkfl.js";const Z=({summa:i,refetch:r,item:t})=>{var h;const[u,b]=k.useState(!1),{company:{currency_type:m}}=ie(),s=()=>{b(!0)},c=()=>{b(!1)},{t:o}=E(),p=Oe().shape({cash:G().nullable(),card:G().nullable(),other:G().nullable()}).test("one-of-three-required",o("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!"),function(a){const{path:j,createError:d}=this,O=parseFloat(a.cash)||0,L=parseFloat(a.card)||0,w=parseFloat(a.other)||0;return O>0||L>0||w>0?!0:d({path:`${j}.cash`,message:o("Naqt, Karta orqali yoki Boshqa maydonlaridan biri kiritilishi shart!")})}).test("total-less-than-summa",o("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!"),function(a){const{path:j,createError:d}=this,O=parseFloat(a.cash)||0,L=parseFloat(a.card)||0,w=parseFloat(a.other)||0;return O+L+w<=i?!0:d({path:`${j}.total_summa`,message:o("To'lovlarning umumiy summasi qarzdorlikdan oshmasligi kerak!")})}),I=we(p),{control:S,formState:{errors:y},handleSubmit:R,setValue:z,getValues:x,watch:C,reset:Q}=Le({resolver:I,defaultValues:{date:le(),pay_type:!0}}),{isLoading:_,mutateAsync:A}=ee({mutationFn:De,onSuccess:()=>{te(o("Muvaffaqiyatli bajarildi !")),c(),Q(),r()},onError:a=>{console.log(a)}}),U=a=>{A(Ne({...a,supplier:n.get(t,"id","")}))},F=C("pay_type");k.useEffect(()=>{if(F){const a=x("card")||0,j=x("other")||0,d=i-a-j;d!==x("cash")&&z("cash",d>=0?d:0)}},[i,C("card"),C("other"),F]),k.useEffect(()=>{if(F){const a=x("cash")||0,j=x("other")||0,d=i-a-j;d!==x("card")&&z("card",d>=0?d:0)}},[i,C("cash"),C("other"),F]),k.useEffect(()=>{if(F){const a=x("cash")||0,j=x("card")||0,d=i-a-j;d!==x("other")&&z("other",d>=0?d:0)}},[i,C("cash"),C("card"),F]);const N=C(["cash","card","other"]).reduce((a,j)=>a+(parseFloat(j)||0),0);return e.jsxs(e.Fragment,{children:[e.jsx(D,{onClick:s,type:"primary",children:o("To'lov qilish")}),e.jsx(Ke,{width:400,centered:!0,title:o("To'lov qilish"),open:u,onCancel:c,footer:[e.jsxs(T,{align:"center",gap:"middle",justify:"end",children:[e.jsx(D,{onClick:c,children:o("Bekor qilish")},"cancel"),e.jsx(D,{type:"primary",disabled:_,loading:_,onClick:R(U),children:o("To'lash")},"submit")]})],children:e.jsx(v,{layout:"vertical",onFinish:R(U),style:{margin:"30px 0px"},children:e.jsxs(P,{gutter:[20,15],children:[e.jsx(l,{xs:24,md:24,children:e.jsx(g,{type:"danger",title:o("Qarzdorlik").toUpperCase(),value:f(i),icon:e.jsx(ce,{})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{label:o("Barcha qarzdorlikni to'lash"),...q(y,"pay_type"),required:!0,children:e.jsx(B,{name:"pay_type",control:S,render:({field:a})=>e.jsx(Ae,{prefix:e.jsx($,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{label:o("Naqt"),...q(y,"cash"),required:!0,help:(h=y.cash)==null?void 0:h.message,validateStatus:y.cash?"error":"",children:e.jsx(B,{name:"cash",control:S,render:({field:a})=>e.jsx(K,{addonAfter:m,prefix:e.jsx($,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{label:o("Karta orqali"),...q(y,"card"),required:!0,children:e.jsx(B,{name:"card",control:S,render:({field:a})=>e.jsx(K,{addonAfter:m,prefix:e.jsx(de,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{label:o("Boshqa"),...q(y,"other"),required:!0,children:e.jsx(B,{name:"other",control:S,render:({field:a})=>e.jsx(K,{addonAfter:m,prefix:e.jsx(he,{}),...a})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{...q(y,"total_summa"),children:e.jsx(g,{type:"success",title:o("To'lanayotgan summa").toUpperCase(),value:f(N),icon:e.jsx(me,{})})})}),e.jsx(l,{xs:24,md:24,children:e.jsx(v.Item,{label:o("Sana"),...q(y,"date"),required:!0,children:e.jsx(B,{name:"date",control:S,render:({field:a})=>e.jsx(Qe,{...a})})})})]})})})]})},He=()=>{const{t:i}=E(),{id:r}=ae();return[{title:e.jsxs(T,{align:"center",gap:"small",children:[e.jsx(ue,{size:20}),e.jsx("span",{children:i("Omborxona")})]})},{title:e.jsx(re,{to:"/storages/suppliers",children:i("Ta'minotchilar")})},{title:r}]},Et=()=>{const{id:i}=ae(),{t:r}=E(),{data:t,isLoading:u,isError:b,error:m,isFetching:s,refetch:c,isRefetching:o,...p}=ne({queryKey:["supplier-one",i],queryFn:()=>Re(i),select:S=>S.data}),I=He();return e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx("title",{children:r("Ta'minotchi")})}),e.jsxs(P,{gutter:[20,20],children:[e.jsx(l,{span:24,children:e.jsxs(T,{align:"center",justify:"space-between",children:[e.jsx(Be,{children:r("Ta'minotchi")}),e.jsx(ke,{})]})}),e.jsx(l,{span:24,children:e.jsx(Ee,{items:I})}),e.jsx(l,{span:24,children:u?e.jsx(Ie,{}):e.jsx(e.Fragment,{children:m?e.jsx(ze,{error:m}):e.jsx(e.Fragment,{children:e.jsxs(qe,{tabPosition:"top",children:[e.jsx(H.TabPane,{tab:r("Umumiy ma'lumotlar"),children:e.jsxs(P,{gutter:[20,20],children:[e.jsx(l,{xs:24,md:16,children:e.jsx(V,{children:e.jsxs(T,{vertical:!0,gap:"large",children:[e.jsx(g,{title:r("Ta'minotchi").toUpperCase(),value:n.get(t,"name",""),icon:e.jsx(xe,{})}),e.jsx(g,{title:r("Telefon").toUpperCase(),value:n.get(t,"phone",""),icon:e.jsx(je,{})}),e.jsx(g,{title:r("Ta'minotchi turi").toUpperCase(),value:n.get(t,"supplier_type",""),icon:e.jsx(ge,{})}),e.jsx(g,{title:r("Sana").toUpperCase(),value:se(n.get(t,"added","")),icon:e.jsx(fe,{})}),n.get(t,"desc","")?e.jsx(g,{title:r("Izoh").toUpperCase(),value:n.get(t,"desc",""),icon:e.jsx(ye,{})}):""]})})}),e.jsx(l,{xs:24,md:8,children:e.jsx(V,{title:e.jsx(X,{title:r("To'lov ma'lumotlari")}),children:e.jsxs(T,{vertical:!0,gap:"large",children:[e.jsx(g,{title:r("Qarzdorlik").toUpperCase(),value:f(n.get(t,"debt_balance",0)),icon:e.jsx(J,{})}),e.jsx(Y,{style:{margin:"0"}}),e.jsx(g,{title:r("Holati").toUpperCase(),value:n.get(t,"status","")==="Qarzdorlik"?e.jsxs(M,{color:"red",children:[r("Qardorlik")," (",f(n.get(t,"debt_balance","")),")"]}):e.jsx(M,{color:"green",children:r("To'langan")}),icon:e.jsx(W,{})}),n.get(t,"status","")==="Qarzdorlik"&&e.jsx(Z,{summa:n.get(t,"debt_balance",""),refetch:c,item:t})]})})})]})},"1"),e.jsx(H.TabPane,{tab:r("Omborga mahsulot"),children:e.jsx(Ve,{supplier:n.get(t,"id",""),supplierRefetch:c})},"2"),e.jsx(H.TabPane,{tab:r("To'lovlar"),children:e.jsxs(P,{gutter:[20,20],children:[e.jsx(l,{xs:24,md:16,children:e.jsx($e,{data:n.get(t,"payments",[]),refetch:c})}),e.jsx(l,{xs:24,md:8,children:e.jsx(V,{title:e.jsx(X,{title:r("To'lov ma'lumotlari")}),children:e.jsxs(T,{vertical:!0,gap:"large",children:[e.jsx(g,{title:r("Qarzdorlik").toUpperCase(),value:f(n.get(t,"debt_balance",0)),icon:e.jsx(J,{})}),e.jsx(Y,{style:{margin:"0"}}),e.jsx(g,{title:r("Holati").toUpperCase(),value:n.get(t,"status","")==="Qarzdorlik"?e.jsxs(M,{color:"red",children:[r("Qardorlik")," (",f(n.get(t,"debt_balance","")),")"]}):e.jsx(M,{color:"green",children:r("To'langan")}),icon:e.jsx(W,{})}),n.get(t,"status","")==="Qarzdorlik"&&e.jsx(Z,{summa:n.get(t,"debt_balance",""),refetch:c,item:t})]})})})]})},"4")]})})})})]})]})},Ve=({supplier:i,supplierRefetch:r})=>{E();const t=Ce(),[u,b]=k.useState({current:1,pageSize:10,total:null}),[m,s]=k.useState({}),[c,o]=k.useState(""),{data:p,isLoading:I,isError:S,error:y,isFetching:R,refetch:z,isRefetching:x,...C}=ne({queryKey:["storage-products",{page:u.current,pageSize:u.pageSize,filters:m}],queryFn:()=>Ue(u.current,u.pageSize,be({supplier:i,...m})),select:h=>h.data,keepPreviousData:!0});k.useEffect(()=>{p&&b(h=>({...h,current:p.current||1,pageSize:p.pageSize||10,total:p.total||""}))},[p]);const Q=(h,a)=>{b({...h}),s(a)},_=()=>{s({}),o("")},A=h=>{s({...m,search:h})},U=h=>{o(h.target.value)},N=_e(u,m,s,()=>{z(),r()}).filter(h=>h.key!=="supplier");return e.jsx(e.Fragment,{children:e.jsx(P,{gutter:[20,20],children:e.jsx(l,{span:24,children:e.jsxs(P,{gutter:[20,20],children:[e.jsx(l,{xs:24,sm:24,md:24,lg:6,xl:6,children:e.jsx(Te,{value:c,enterButton:!0,onSearch:A,onChange:U})}),e.jsx(l,{xs:24,sm:24,md:24,lg:18,xl:18,children:e.jsxs(T,{align:"center",justify:"end",gap:"middle",children:[e.jsx(Fe,{onClick:_}),e.jsx(ve,{onClick:()=>t("/storages/storage-products/create")})]})}),e.jsx(l,{span:24,children:e.jsx(oe,{columns:N,data:(p==null?void 0:p.results)||[],pagination:u,loading:I||x,onChange:Q})})]})})})})};function $e({data:i,refetch:r}){const{t}=E(),u=ee({mutationFn:Me,onSuccess:()=>{te(t("Muvaffaqiyatli bajarildi !")),r()},onError:s=>{console.log(s)}}),b=s=>{u.mutate(s)},m=[{title:t("#"),dataIndex:"index",key:"index",render:(s,c,o)=>e.jsx(e.Fragment,{children:o+1})},{title:t("Omborga mahsulot"),dataIndex:"storage_product",key:"storage_product",render:s=>e.jsx(e.Fragment,{children:e.jsx(re,{to:`/storages/storage-products/${s}`,children:t("Ko'rish")})})},{title:t("Naqt"),dataIndex:"cash",key:"cash",hidden:!0,render:s=>e.jsx(e.Fragment,{children:f(s)})},{title:t("Karta"),dataIndex:"card",key:"card",hidden:!0,render:s=>e.jsx(e.Fragment,{children:f(s)})},{title:t("Boshqa"),dataIndex:"other",key:"other",hidden:!0,render:s=>e.jsx(e.Fragment,{children:f(s)})},{title:t("Jami summa"),dataIndex:"total",key:"total",render:(s,c)=>e.jsx(e.Fragment,{children:f(c.cash+c.card+c.other)})},{title:t("Sana"),dataIndex:"date",key:"date",render:s=>e.jsx(e.Fragment,{children:se(s)})},{title:e.jsx(Se,{size:15}),dataIndex:"id",key:"operation",align:"center",width:50,align:"center",render:s=>e.jsx(T,{align:"center",justify:"space-between",gap:"small",children:e.jsx(Pe,{trigger:e.jsx(D,{danger:!0,icon:e.jsx(Ge,{})}),onOk:()=>b(s)})})}];return e.jsx(oe,{title:t("To'lovlar"),data:i,columns:m})}export{Et as default};
